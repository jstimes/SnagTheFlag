!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){var a=n(1),r=n(2);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i={insert:"head",singleton:!1};a(r,i);e.exports=r.locals||{}},function(e,t,n){"use strict";var a,r=function(){return void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a},i=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),o=[];function s(e){for(var t=-1,n=0;n<o.length;n++)if(o[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},a=[],r=0;r<e.length;r++){var i=e[r],l=t.base?i[0]+t.base:i[0],c=n[l]||0,y="".concat(l," ").concat(c);n[l]=c+1;var h=s(y),u={css:i[1],media:i[2],sourceMap:i[3]};-1!==h?(o[h].references++,o[h].updater(u)):o.push({identifier:y,updater:g(u,t),references:1}),a.push(y)}return a}function c(e){var t=document.createElement("style"),a=e.attributes||{};if(void 0===a.nonce){var r=n.nc;r&&(a.nonce=r)}if(Object.keys(a).forEach((function(e){t.setAttribute(e,a[e])})),"function"==typeof e.insert)e.insert(t);else{var o=i(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var y,h=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function u(e,t,n,a){var r=n?"":a.media?"@media ".concat(a.media," {").concat(a.css,"}"):a.css;if(e.styleSheet)e.styleSheet.cssText=h(t,r);else{var i=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function x(e,t,n){var a=n.css,r=n.media,i=n.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),i&&btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}var d=null,f=0;function g(e,t){var n,a,r;if(t.singleton){var i=f++;n=d||(d=c(t)),a=u.bind(null,n,i,!1),r=u.bind(null,n,i,!0)}else n=c(t),a=x.bind(null,n,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=r());var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var a=0;a<n.length;a++){var r=s(n[a]);o[r].references--}for(var i=l(e,t),c=0;c<n.length;c++){var y=s(n[c]);0===o[y].references&&(o[y].updater(),o.splice(y,1))}n=i}}}},function(e,t,n){(t=n(3)(!1)).push([e.i,"._3Mwv5So4MvxeCu4kT6nAa7 {\n    background-color: #000000;\n}",""]),t.locals={body:"_3Mwv5So4MvxeCu4kT6nAa7"},e.exports=t},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",a=e[3];if(!a)return n;if(t&&"function"==typeof btoa){var r=(o=a,s=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(l," */")),i=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[n].concat(i).concat([r]).join("\n")}var o,s,l;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,a){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(a)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(r[o]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);a&&r[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(e,t,n){"use strict";n.r(t),n.d(t,"Main",(function(){return Vt}));var a={canvasHeight:800,canvasWidth:1040,frameRate:60,msBetweenRenders:1e3/60};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var r=function(){return(r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function i(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=i.next()).done;)o.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o}function s(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e}var l,c,y=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.dot=function(e){return this.x*e.x+this.y*e.y},e.prototype.getMagnitude=function(){return Math.sqrt(this.dot(this))},e.prototype.normalize=function(){var t=this.getMagnitude();return new e(this.x/t,this.y/t)},e.prototype.multiplyScaler=function(t){return new e(this.x*t,this.y*t)},e.prototype.distanceTo=function(e){return e.subtract(this).getMagnitude()},e.prototype.manhattanDistanceTo=function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},e.prototype.getPointRotationRadians=function(){return Math.atan2(this.y,this.x)},e.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},e.prototype.toString=function(){return"("+this.x+", "+this.y+")"},e.prototype.getNormalVectorClockwise=function(){return new e(this.y,-this.x)},e.prototype.getNormalVectorCounterclockwise=function(){return new e(-this.y,this.x)},e.prototype.reflect=function(e){return this.subtract(e.multiplyScaler(2*this.dot(e)))},e}();function h(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return!0;return!1}function u(e){return new y(e.x,e.y)}!function(e){e[e.KeyDown=0]="KeyDown",e[e.KeyUp=1]="KeyUp",e[e.KeyPress=2]="KeyPress"}(l||(l={})),function(e){e[e.NOT_STARTED=0]="NOT_STARTED",e[e.READY=1]="READY",e[e.DOWN=2]="DOWN"}(c||(c={}));var x,d=function(){function e(){this.assignedControls=new Map,this.keyToEventType=new Map,this.keyToKeyPressState=new Map}return e.prototype.add=function(e){this.assignedControls.set(e.key,e.func),p.addAssignedControl(e.key,e.name),this.keyToEventType.set(e.key,e.eventType),e.eventType===l.KeyPress&&this.keyToKeyPressState.set(e.key,p.isKeyDown(e.key)?c.NOT_STARTED:c.READY)},e.prototype.remove=function(e){p.removeAssignedControl(e),this.assignedControls.delete(e),this.keyToEventType.delete(e)},e.prototype.clear=function(){var e,t;try{for(var n=i(this.assignedControls.keys()),a=n.next();!a.done;a=n.next()){var r=a.value;p.removeAssignedControl(r)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.assignedControls.clear(),this.keyToEventType.clear()},e.prototype.check=function(){var e,t;try{for(var n=i(this.assignedControls.keys()),a=n.next();!a.done;a=n.next()){var r=a.value,o=this.keyToEventType.get(r),s=p.isKeyDown(r);if(o===l.KeyDown&&s||o===l.KeyUp&&!s)this.assignedControls.get(r)();else if(o===l.KeyPress){var y=this.keyToKeyPressState.get(r);if(s)y===c.READY&&this.keyToKeyPressState.set(r,c.DOWN);else switch(y){case c.DOWN:this.assignedControls.get(r)(),this.keyToKeyPressState.set(r,c.READY);break;case c.NOT_STARTED:this.keyToKeyPressState.set(r,c.READY)}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e}(),f=function(){function e(){var e,t,n=this;this.keyMap=new Map,this.assignedControlMap=new Map,this.mouseCanvasCoords=new y(0,0),this.isMouseDownInternal=!1,this.hasClickInternal=!1;var a=Object.keys(x).filter((function(e){return!isNaN(Number(x[e]))}));try{for(var r=i(a),o=r.next();!o.done;o=r.next()){var s=o.value;this.keyMap.set(x[s],!1)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}document.onkeydown=function(e){n.keyMap.set(e.keyCode,!0)},document.onkeyup=function(e){n.keyMap.set(e.keyCode,!1)}}return e.prototype.initMouseControls=function(e){var t=this;e.onmousemove=function(n){var r,i=e.getBoundingClientRect(),o=new y(n.clientX-i.left,n.clientY-i.top);(r=o).x>=0&&r.x<=a.canvasWidth&&r.y>=0&&r.y<=a.canvasHeight&&(t.mouseCanvasCoords=o)},e.onmousedown=function(e){t.isMouseDownInternal=!0},e.onmouseup=function(e){t.isMouseDownInternal=!1},e.onclick=function(e){t.hasClickInternal=!0}},e.prototype.hasClick=function(){return this.hasClickInternal},e.prototype.handleClick=function(){if(!this.hasClick())throw new Error("Must check hasClick before handleClick, or click already handled.");return this.hasClickInternal=!1,this.mouseCanvasCoords},e.prototype.getMouseCanvasCoords=function(){return this.mouseCanvasCoords},e.prototype.isMouseDown=function(){return this.isMouseDownInternal},e.prototype.isKeyDown=function(e){var t=this.keyMap.get(e);if(null==t)throw new Error("Called isKeyDown for unmapped key: "+this.getStringForKey(e));return t},e.prototype.addAssignedControl=function(e,t){if(this.assignedControlMap.has(e))throw new Error("Double-bound a control: "+e);this.assignedControlMap.set(e,t),this.keyMap.has(e)||this.keyMap.set(e,!1)},e.prototype.removeAssignedControl=function(e){if(!this.assignedControlMap.has(e))throw new Error("Removing unassigned control");this.assignedControlMap.delete(e)},e.prototype.getAssignedControlMap=function(){return this.assignedControlMap},e.prototype.getStringForKey=function(e){switch(e){case x.SHIFT:return"Shift";case x.A:return"A";case x.B:return"B";case x.C:return"C";case x.D:return"D";case x.E:return"E";case x.F:return"F";case x.G:return"G";case x.H:return"H";case x.I:return"I";case x.J:return"J";case x.K:return"K";case x.L:return"L";case x.M:return"M";case x.N:return"N";case x.O:return"O";case x.P:return"P";case x.Q:return"Q";case x.R:return"R";case x.S:return"S";case x.T:return"T";case x.U:return"U";case x.V:return"V";case x.W:return"W";case x.X:return"X";case x.Y:return"Y";case x.Z:return"Z";case x.ONE:return"1";case x.TWO:return"2";case x.THREE:return"3";case x.FOUR:return"4";case x.FIVE:return"5";case x.SIX:return"6";case x.SEVEN:return"7";case x.EIGHT:return"8";case x.NINE:return"9";case x.ZERO:return"0";case x.SPACE:return"Space";case x.QUESTION_MARK:return"?";case x.LEFT_ARROW:return"Left arrow";case x.UP_ARROW:return"Up arrow";case x.RIGHT_ARROW:return"Right arrow";case x.DOWN_ARROW:return"Down arrow";default:throw new Error("Need to add string for Key")}},e}();!function(e){e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.SPACE=32]="SPACE",e[e.LEFT_ARROW=37]="LEFT_ARROW",e[e.UP_ARROW=38]="UP_ARROW",e[e.RIGHT_ARROW=39]="RIGHT_ARROW",e[e.DOWN_ARROW=40]="DOWN_ARROW",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.ZERO=58]="ZERO",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.QUESTION_MARK=191]="QUESTION_MARK"}(x||(x={}));var g=new Map([[1,x.ONE],[2,x.TWO],[3,x.THREE],[4,x.FOUR],[5,x.FIVE],[6,x.SIX],[7,x.SEVEN],[8,x.EIGHT],[9,x.NINE]]),m=new Map([[1,"1st"],[2,"2nd"],[3,"3rd"],[4,"4th"],[5,"5th"],[6,"6th"],[7,"7th"],[8,"8th"],[9,"9th"]]),p=new f,T=new y(0,-1),v=new y(0,1),S=new y(-1,0),C=new y(1,0);var E=function(){function e(){}return e.getCanvasFromTileCoords=function(t){return new y(t.x*e.TILE_SIZE,t.y*e.TILE_SIZE)},e.getTileFromCanvasCoords=function(t){return new y(Math.floor(t.x/e.TILE_SIZE),Math.floor(t.y/e.TILE_SIZE))},e.inbounds=function(t){return t.x>=0&&t.x<e.TILES_WIDE&&t.y>=0&&t.y<e.TILES_TALL},e.getAdjacentTiles=function(t){var n=[],a=t.add(T),r=t.add(v),i=t.add(S),o=t.add(C);return e.inbounds(a)&&n.push(a),e.inbounds(r)&&n.push(r),e.inbounds(i)&&n.push(i),e.inbounds(o)&&n.push(o),n},e.BUTTON_PANE_WIDTH=240,e.BUTTON_PANE_HEIGHT=a.canvasHeight,e.GAME_WIDTH=a.canvasWidth-e.BUTTON_PANE_WIDTH,e.GAME_HEIGHT=a.canvasHeight,e.TILE_SIZE=40,e.TILES_WIDE=e.GAME_WIDTH/e.TILE_SIZE,e.TILES_TALL=e.GAME_HEIGHT/e.TILE_SIZE,e.HALF_TILE=new y(e.TILE_SIZE/2,e.TILE_SIZE/2),e}();function A(e){for(var t,n,a=e.startTile,r=e.maxDepth,o=e.isAvailable,l=e.canGoThrough,c=new Map,y=E.getAdjacentTiles(a).concat(a).map((function(e){return{depth:1,coords:e}}));y.length;){var h=y.shift();if(!(h.depth>r)&&l(h.coords)){o(h.coords)&&c.set(h.coords.toString(),h.coords);var u=function(e){if(s(c.values()).find((function(t){return t.equals(e)})))return"continue";y.push({depth:h.depth+1,coords:e})};try{for(var x=(t=void 0,i(E.getAdjacentTiles(h.coords))),d=x.next();!d.done;d=x.next()){u(d.value)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=x.return)&&n.call(x)}finally{if(t)throw t.error}}}}return s(c.values())}var I,w,L="#959aa3",b="#1560e8",M="#614447",R="#edb951",_="#0a0a0a88",P=!1,D="#4c6e47",F="#7a5f3e",k="#e34055",O="#3d7cd4",N="#e34055",H="#3d7cd4",G="#b05662",B="#547199",W="#000000",U="#b8b6a589",z="#d9d7bfa9",Z="#d90228bb",q="#e8e1d8",j="#00FF00",K="#FF0000",V="#474747",Y="#427cad",Q="#6392ba",X="#1068b0",J="#000000",$="#cfcfcf",ee="#c2c2c2",te="#959aa3",ne="#1560e8",ae=[{name:"Diagonal",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:16,y:18},{x:16,y:17},{x:16,y:16},{x:17,y:16},{x:18,y:16},{x:1,y:3},{x:2,y:3},{x:3,y:3},{x:3,y:2},{x:3,y:1},{x:0,y:6},{x:1,y:6},{x:2,y:6},{x:3,y:6},{x:6,y:0},{x:6,y:1},{x:6,y:2},{x:6,y:3},{x:6,y:6},{x:6,y:7},{x:6,y:8},{x:6,y:9},{x:7,y:6},{x:8,y:6},{x:9,y:6},{x:13,y:19},{x:13,y:18},{x:13,y:17},{x:13,y:16},{x:19,y:13},{x:18,y:13},{x:17,y:13},{x:16,y:13},{x:13,y:13},{x:13,y:12},{x:13,y:11},{x:13,y:10},{x:12,y:13},{x:11,y:13},{x:10,y:13},{x:10,y:9},{x:10,y:10},{x:9,y:10},{x:9,y:9},{x:13,y:6},{x:13,y:5},{x:13,y:4},{x:14,y:6},{x:15,y:6},{x:6,y:13},{x:6,y:14},{x:6,y:15},{x:5,y:13},{x:4,y:13},{x:3,y:16},{x:2,y:16},{x:2,y:17},{x:3,y:17},{x:16,y:3},{x:16,y:2},{x:17,y:2},{x:17,y:3},{x:3,y:9},{x:3,y:10},{x:9,y:3},{x:10,y:3},{x:10,y:16},{x:9,y:16},{x:16,y:10},{x:16,y:9},{x:17,y:10},{x:10,y:17},{x:2,y:9},{x:9,y:2},{x:6,y:19},{x:6,y:18},{x:1,y:13},{x:0,y:13},{x:13,y:1},{x:13,y:0},{x:18,y:6},{x:19,y:6}]},aiSpawner:{x:1,y:18}},{name:"Horizontal",data:{redFlag:{x:10,y:19},blueFlag:{x:9,y:0},obstacles:[{x:2,y:17},{x:3,y:17},{x:5,y:17},{x:6,y:17},{x:7,y:17},{x:10,y:17},{x:13,y:17},{x:14,y:17},{x:17,y:17},{x:8,y:17},{x:9,y:17},{x:11,y:17},{x:12,y:17},{x:16,y:17},{x:17,y:2},{x:16,y:2},{x:14,y:2},{x:13,y:2},{x:12,y:2},{x:11,y:2},{x:10,y:2},{x:9,y:2},{x:8,y:2},{x:7,y:2},{x:6,y:2},{x:5,y:2},{x:3,y:2},{x:2,y:2},{x:3,y:5},{x:4,y:5},{x:5,y:5},{x:14,y:5},{x:15,y:5},{x:16,y:5},{x:14,y:15},{x:15,y:15},{x:16,y:15},{x:4,y:15},{x:5,y:15},{x:3,y:15},{x:6,y:15},{x:13,y:15},{x:13,y:5},{x:6,y:5},{x:1,y:9},{x:1,y:10},{x:0,y:9},{x:1,y:8},{x:19,y:9},{x:18,y:9},{x:18,y:8},{x:18,y:10},{x:2,y:8},{x:17,y:8},{x:18,y:11},{x:1,y:11},{x:4,y:11},{x:5,y:11},{x:6,y:11},{x:7,y:11},{x:8,y:11},{x:8,y:12},{x:11,y:12},{x:11,y:11},{x:12,y:11},{x:13,y:11},{x:15,y:11},{x:14,y:11},{x:9,y:9},{x:10,y:9},{x:11,y:9},{x:8,y:9},{x:9,y:15},{x:10,y:15},{x:9,y:5},{x:10,y:5},{x:8,y:7},{x:7,y:7},{x:6,y:7},{x:11,y:7},{x:12,y:7},{x:13,y:7}]},aiSpawner:{x:10,y:18}},{name:"Paths",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:17,y:1},{x:17,y:2},{x:18,y:2},{x:1,y:17},{x:2,y:17},{x:2,y:18},{x:1,y:16},{x:3,y:18},{x:16,y:1},{x:18,y:3},{x:16,y:5},{x:15,y:6},{x:14,y:7},{x:13,y:8},{x:14,y:3},{x:13,y:4},{x:12,y:5},{x:11,y:6},{x:10,y:7},{x:10,y:6},{x:11,y:5},{x:12,y:4},{x:13,y:3},{x:14,y:8},{x:15,y:7},{x:16,y:6},{x:13,y:9},{x:12,y:9},{x:3,y:14},{x:5,y:16},{x:6,y:16},{x:3,y:13},{x:4,y:13},{x:6,y:15},{x:7,y:15},{x:7,y:14},{x:4,y:12},{x:8,y:14},{x:8,y:13},{x:5,y:12},{x:5,y:11},{x:6,y:11},{x:6,y:10},{x:9,y:13},{x:9,y:12},{x:7,y:10},{x:9,y:10},{x:9,y:9},{x:10,y:9},{x:10,y:10},{x:16,y:9},{x:7,y:7},{x:7,y:6},{x:6,y:6},{x:6,y:5},{x:5,y:5},{x:12,y:12},{x:12,y:13},{x:13,y:13},{x:13,y:14},{x:14,y:14},{x:14,y:15},{x:15,y:15},{x:5,y:4},{x:4,y:4},{x:15,y:18},{x:16,y:18},{x:16,y:17},{x:17,y:17},{x:17,y:16},{x:18,y:16},{x:18,y:15},{x:2,y:2},{x:3,y:2},{x:3,y:1},{x:4,y:1},{x:2,y:3},{x:1,y:3},{x:1,y:4},{x:16,y:10},{x:17,y:11},{x:16,y:12},{x:16,y:13},{x:3,y:6},{x:3,y:7},{x:2,y:8},{x:3,y:9},{x:3,y:10},{x:18,y:9},{x:19,y:9},{x:19,y:8},{x:0,y:10},{x:1,y:10},{x:1,y:11},{x:8,y:4},{x:7,y:3},{x:10,y:3},{x:11,y:2},{x:12,y:1},{x:6,y:2},{x:11,y:15},{x:12,y:16},{x:13,y:17},{x:9,y:16},{x:8,y:17},{x:7,y:18},{x:9,y:0},{x:10,y:19}]},aiSpawner:{x:1,y:18}},{name:"Symmetry",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:16,y:1},{x:16,y:2},{x:16,y:3},{x:17,y:3},{x:18,y:3},{x:13,y:0},{x:13,y:1},{x:13,y:3},{x:13,y:2},{x:15,y:6},{x:16,y:6},{x:17,y:6},{x:18,y:6},{x:19,y:6},{x:12,y:7},{x:13,y:8},{x:11,y:6},{x:11,y:5},{x:11,y:4},{x:11,y:3},{x:11,y:2},{x:14,y:8},{x:15,y:8},{x:16,y:8},{x:17,y:8},{x:19,y:10},{x:17,y:10},{x:18,y:10},{x:16,y:10},{x:14,y:10},{x:15,y:10},{x:13,y:10},{x:10,y:9},{x:10,y:10},{x:9,y:10},{x:9,y:9},{x:7,y:12},{x:8,y:13},{x:8,y:14},{x:8,y:15},{x:8,y:16},{x:8,y:17},{x:6,y:11},{x:5,y:11},{x:4,y:11},{x:2,y:11},{x:3,y:11},{x:0,y:13},{x:1,y:13},{x:2,y:13},{x:3,y:13},{x:4,y:13},{x:6,y:15},{x:6,y:16},{x:6,y:17},{x:6,y:18},{x:6,y:19},{x:3,y:16},{x:2,y:16},{x:1,y:16},{x:3,y:17},{x:3,y:18},{x:10,y:13},{x:10,y:14},{x:10,y:15},{x:10,y:16},{x:10,y:17},{x:10,y:18},{x:10,y:19},{x:11,y:11},{x:12,y:12},{x:13,y:13},{x:14,y:14},{x:12,y:13},{x:13,y:12},{x:13,y:14},{x:14,y:13},{x:13,y:15},{x:13,y:16},{x:14,y:16},{x:15,y:16},{x:15,y:15},{x:16,y:16},{x:16,y:15},{x:16,y:14},{x:15,y:14},{x:15,y:13},{x:16,y:13},{x:14,y:15},{x:16,y:17},{x:17,y:17},{x:17,y:16},{x:8,y:8},{x:7,y:7},{x:6,y:7},{x:6,y:6},{x:7,y:6},{x:6,y:5},{x:6,y:4},{x:6,y:3},{x:5,y:3},{x:4,y:3},{x:3,y:3},{x:3,y:4},{x:3,y:5},{x:3,y:6},{x:4,y:6},{x:5,y:6},{x:5,y:4},{x:4,y:4},{x:5,y:5},{x:4,y:5},{x:3,y:2},{x:2,y:3},{x:2,y:2},{x:0,y:0},{x:19,y:19},{x:13,y:19},{x:19,y:13},{x:6,y:0},{x:0,y:6},{x:6,y:9},{x:5,y:9},{x:4,y:9},{x:3,y:9},{x:1,y:9},{x:2,y:9},{x:0,y:9},{x:9,y:6},{x:9,y:5},{x:9,y:4},{x:9,y:3},{x:9,y:2},{x:9,y:1},{x:9,y:0}]},aiSpawner:{x:2,y:17}},{name:"Squares",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:17,y:2},{x:16,y:2},{x:16,y:3},{x:17,y:3},{x:12,y:7},{x:8,y:10},{x:8,y:11},{x:9,y:11},{x:1,y:17},{x:2,y:18},{x:2,y:17},{x:16,y:1},{x:17,y:1},{x:18,y:2},{x:18,y:3},{x:1,y:16},{x:2,y:16},{x:3,y:16},{x:3,y:17},{x:3,y:18},{x:5,y:14},{x:5,y:13},{x:5,y:12},{x:6,y:12},{x:7,y:12},{x:7,y:13},{x:7,y:14},{x:6,y:14},{x:6,y:13},{x:10,y:8},{x:11,y:9},{x:11,y:8},{x:12,y:6},{x:13,y:7},{x:13,y:6},{x:13,y:5},{x:14,y:5},{x:14,y:6},{x:14,y:7},{x:12,y:5},{x:12,y:12},{x:12,y:13},{x:12,y:14},{x:13,y:14},{x:14,y:14},{x:14,y:13},{x:14,y:12},{x:13,y:12},{x:13,y:13},{x:13,y:9},{x:13,y:10},{x:14,y:10},{x:14,y:9},{x:9,y:13},{x:9,y:14},{x:10,y:14},{x:10,y:13},{x:15,y:12},{x:15,y:13},{x:15,y:14},{x:15,y:15},{x:14,y:15},{x:13,y:15},{x:12,y:15},{x:13,y:17},{x:14,y:17},{x:14,y:18},{x:13,y:18},{x:17,y:13},{x:17,y:14},{x:18,y:14},{x:18,y:13},{x:17,y:17},{x:17,y:18},{x:18,y:18},{x:18,y:17},{x:7,y:7},{x:7,y:6},{x:7,y:5},{x:7,y:4},{x:4,y:4},{x:4,y:5},{x:4,y:6},{x:4,y:7},{x:5,y:7},{x:6,y:7},{x:6,y:6},{x:5,y:6},{x:6,y:5},{x:5,y:5},{x:5,y:4},{x:6,y:4},{x:5,y:9},{x:6,y:9},{x:6,y:10},{x:5,y:10},{x:9,y:6},{x:10,y:6},{x:10,y:5},{x:9,y:5},{x:6,y:2},{x:6,y:1},{x:5,y:1},{x:5,y:2},{x:2,y:5},{x:1,y:5},{x:1,y:6},{x:2,y:6},{x:2,y:2},{x:1,y:2},{x:1,y:1},{x:2,y:1},{x:9,y:2},{x:10,y:2},{x:10,y:1},{x:9,y:1},{x:17,y:9},{x:17,y:10},{x:18,y:10},{x:18,y:9},{x:2,y:9},{x:1,y:9},{x:1,y:10},{x:2,y:10},{x:9,y:17},{x:10,y:17},{x:10,y:18},{x:9,y:18},{x:16,y:5},{x:17,y:6},{x:18,y:7},{x:12,y:1},{x:13,y:2},{x:14,y:3},{x:1,y:12},{x:2,y:13},{x:3,y:14},{x:5,y:16},{x:6,y:17},{x:7,y:18},{x:5,y:19},{x:0,y:14},{x:19,y:5},{x:14,y:0},{x:9,y:10},{x:10,y:9}]},aiSpawner:{x:1,y:18}},{name:"Corners",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:17,y:1},{x:18,y:2},{x:14,y:1},{x:15,y:1},{x:15,y:2},{x:18,y:4},{x:17,y:4},{x:18,y:5},{x:15,y:4},{x:14,y:4},{x:15,y:5},{x:12,y:7},{x:11,y:7},{x:12,y:8},{x:4,y:14},{x:4,y:15},{x:5,y:15},{x:1,y:17},{x:2,y:18},{x:1,y:15},{x:1,y:14},{x:2,y:15},{x:4,y:18},{x:4,y:17},{x:5,y:18},{x:7,y:12},{x:7,y:11},{x:8,y:12},{x:9,y:9},{x:10,y:10},{x:15,y:16},{x:16,y:15},{x:18,y:19},{x:19,y:18},{x:16,y:16},{x:19,y:19},{x:3,y:3},{x:3,y:4},{x:4,y:3},{x:0,y:1},{x:0,y:0},{x:1,y:0},{x:19,y:16},{x:18,y:16},{x:19,y:15},{x:15,y:19},{x:16,y:19},{x:16,y:18},{x:0,y:3},{x:0,y:4},{x:1,y:3},{x:3,y:6},{x:3,y:7},{x:4,y:7},{x:15,y:12},{x:16,y:12},{x:16,y:13},{x:13,y:16},{x:12,y:16},{x:12,y:15},{x:13,y:18},{x:12,y:18},{x:12,y:19},{x:18,y:13},{x:18,y:12},{x:19,y:12},{x:3,y:1},{x:3,y:0},{x:4,y:0},{x:0,y:7},{x:1,y:7},{x:1,y:6},{x:6,y:1},{x:7,y:1},{x:7,y:0},{x:7,y:3},{x:6,y:3},{x:7,y:4},{x:7,y:6},{x:6,y:7},{x:12,y:13},{x:13,y:12},{x:6,y:6},{x:13,y:13},{x:15,y:10},{x:16,y:10},{x:15,y:9},{x:18,y:10},{x:19,y:10},{x:19,y:9},{x:0,y:10},{x:0,y:9},{x:1,y:9},{x:3,y:9},{x:4,y:9},{x:4,y:10},{x:7,y:15},{x:8,y:15},{x:8,y:14},{x:7,y:17},{x:8,y:17},{x:8,y:18},{x:12,y:2},{x:11,y:2},{x:11,y:1},{x:11,y:4},{x:12,y:4},{x:11,y:5},{x:16,y:7},{x:17,y:7},{x:17,y:8},{x:2,y:11},{x:2,y:12},{x:3,y:12},{x:10,y:13},{x:9,y:6},{x:9,y:3},{x:10,y:16}]},aiSpawner:{x:1,y:18}},{name:"Spotted",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:1,y:1},{x:2,y:2},{x:3,y:3},{x:9,y:9},{x:10,y:10},{x:11,y:11},{x:17,y:17},{x:18,y:18},{x:8,y:8},{x:16,y:16},{x:10,y:9},{x:11,y:8},{x:9,y:10},{x:8,y:11},{x:6,y:13},{x:5,y:14},{x:13,y:6},{x:14,y:5},{x:16,y:3},{x:17,y:2},{x:3,y:16},{x:2,y:17},{x:1,y:17},{x:2,y:18},{x:18,y:2},{x:17,y:1},{x:13,y:5},{x:14,y:6},{x:5,y:13},{x:6,y:14},{x:8,y:16},{x:9,y:17},{x:11,y:19},{x:3,y:11},{x:2,y:10},{x:0,y:8},{x:0,y:7},{x:12,y:19},{x:11,y:3},{x:10,y:2},{x:16,y:8},{x:17,y:9},{x:19,y:11},{x:19,y:12},{x:8,y:0},{x:7,y:0},{x:13,y:13},{x:14,y:14},{x:6,y:6},{x:5,y:5},{x:4,y:7},{x:3,y:8},{x:7,y:4},{x:8,y:3},{x:8,y:4},{x:7,y:3},{x:4,y:8},{x:3,y:7},{x:12,y:15},{x:11,y:15},{x:11,y:16},{x:12,y:16},{x:15,y:12},{x:16,y:12},{x:16,y:11},{x:15,y:11},{x:13,y:10},{x:10,y:13},{x:6,y:9},{x:9,y:6},{x:2,y:1},{x:1,y:2},{x:2,y:3},{x:3,y:2},{x:16,y:17},{x:17,y:18},{x:18,y:17},{x:17,y:16},{x:1,y:7},{x:12,y:18},{x:18,y:12},{x:7,y:1},{x:5,y:18},{x:6,y:19},{x:1,y:14},{x:0,y:13},{x:18,y:5},{x:19,y:6},{x:13,y:1},{x:12,y:0},{x:0,y:5},{x:0,y:6},{x:1,y:6},{x:18,y:13},{x:19,y:14},{x:19,y:13},{x:6,y:0},{x:6,y:1},{x:5,y:0},{x:13,y:18},{x:13,y:19},{x:14,y:19}]},aiSpawner:{x:1,y:18}},{name:"Entropy",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:16,y:3},{x:15,y:5},{x:16,y:7},{x:13,y:5},{x:11,y:3},{x:5,y:4},{x:5,y:7},{x:10,y:10},{x:11,y:11},{x:8,y:3},{x:11,y:6},{x:14,y:9},{x:13,y:10},{x:8,y:6},{x:7,y:6},{x:6,y:11},{x:6,y:13},{x:3,y:11},{x:2,y:5},{x:5,y:5},{x:9,y:10},{x:10,y:14},{x:4,y:10},{x:3,y:8},{x:0,y:10},{x:2,y:14},{x:6,y:15},{x:6,y:18},{x:3,y:18},{x:1,y:16},{x:0,y:17},{x:5,y:18},{x:4,y:14},{x:4,y:13},{x:4,y:17},{x:12,y:16},{x:13,y:13},{x:10,y:17},{x:8,y:17},{x:8,y:13},{x:11,y:14},{x:11,y:16},{x:9,y:19},{x:16,y:18},{x:14,y:14},{x:15,y:16},{x:14,y:18},{x:18,y:15},{x:16,y:12},{x:18,y:13},{x:15,y:13},{x:15,y:11},{x:16,y:10},{x:10,y:7},{x:8,y:8},{x:7,y:11},{x:7,y:7},{x:12,y:8},{x:13,y:9},{x:15,y:9},{x:19,y:7},{x:18,y:8},{x:17,y:5},{x:17,y:2},{x:17,y:1},{x:13,y:1},{x:11,y:2},{x:13,y:3},{x:11,y:1},{x:8,y:1},{x:7,y:2},{x:4,y:1},{x:4,y:0},{x:2,y:1},{x:2,y:3},{x:0,y:4},{x:1,y:7},{x:1,y:9},{x:2,y:10},{x:1,y:12},{x:6,y:14},{x:12,y:14},{x:14,y:17},{x:8,y:16},{x:7,y:13},{x:10,y:11},{x:4,y:6},{x:3,y:9},{x:5,y:8},{x:6,y:4},{x:12,y:5},{x:17,y:3},{x:19,y:6},{x:19,y:8},{x:18,y:14},{x:19,y:14},{x:17,y:18},{x:15,y:18},{x:13,y:18},{x:1,y:13},{x:0,y:0},{x:13,y:0},{x:7,y:8},{x:8,y:9},{x:9,y:9},{x:11,y:12},{x:13,y:14},{x:15,y:12},{x:15,y:14},{x:16,y:11},{x:16,y:9},{x:10,y:6},{x:11,y:5},{x:14,y:16},{x:10,y:16},{x:3,y:10},{x:0,y:9},{x:2,y:9},{x:3,y:6}]},aiSpawner:{x:1,y:18}},{name:"Sliced",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:17,y:2},{x:16,y:3},{x:14,y:5},{x:15,y:4},{x:2,y:17},{x:3,y:16},{x:4,y:15},{x:5,y:14},{x:2,y:13},{x:3,y:12},{x:4,y:11},{x:5,y:10},{x:13,y:2},{x:12,y:3},{x:11,y:4},{x:10,y:5},{x:7,y:12},{x:8,y:11},{x:9,y:10},{x:10,y:9},{x:11,y:8},{x:12,y:7},{x:6,y:17},{x:7,y:16},{x:8,y:15},{x:9,y:14},{x:17,y:6},{x:16,y:7},{x:15,y:8},{x:14,y:9},{x:6,y:6},{x:5,y:7},{x:4,y:8},{x:3,y:9},{x:7,y:5},{x:8,y:4},{x:9,y:3},{x:13,y:13},{x:14,y:12},{x:15,y:11},{x:16,y:10},{x:12,y:14},{x:11,y:15},{x:10,y:16},{x:11,y:11},{x:11,y:12},{x:12,y:11},{x:7,y:8},{x:8,y:8},{x:8,y:7},{x:10,y:19},{x:11,y:18},{x:12,y:17},{x:13,y:16},{x:15,y:14},{x:16,y:13},{x:17,y:12},{x:18,y:11},{x:9,y:0},{x:8,y:1},{x:7,y:2},{x:6,y:3},{x:4,y:5},{x:3,y:6},{x:2,y:7},{x:1,y:8},{x:15,y:17},{x:16,y:16},{x:4,y:2},{x:3,y:3},{x:3,y:0},{x:2,y:1},{x:1,y:2},{x:16,y:19},{x:17,y:18},{x:18,y:17},{x:0,y:12},{x:1,y:11},{x:18,y:9},{x:19,y:8},{x:6,y:19},{x:2,y:19},{x:17,y:0},{x:13,y:0},{x:0,y:6},{x:1,y:5},{x:18,y:14},{x:19,y:13},{x:19,y:5},{x:18,y:4},{x:1,y:15},{x:0,y:14}]},aiSpawner:{x:1,y:18}},{name:"Pockets",data:{redFlag:{x:10,y:19},blueFlag:{x:10,y:0},obstacles:[{x:7,y:1},{x:7,y:2},{x:7,y:3},{x:7,y:4},{x:8,y:4},{x:9,y:4},{x:10,y:4},{x:11,y:4},{x:12,y:4},{x:13,y:4},{x:13,y:3},{x:13,y:2},{x:13,y:1},{x:7,y:17},{x:7,y:18},{x:7,y:16},{x:7,y:15},{x:8,y:15},{x:9,y:15},{x:10,y:15},{x:12,y:15},{x:11,y:15},{x:13,y:15},{x:13,y:16},{x:13,y:17},{x:13,y:18},{x:7,y:8},{x:6,y:8},{x:5,y:8},{x:4,y:8},{x:5,y:13},{x:5,y:12},{x:5,y:11},{x:6,y:11},{x:7,y:11},{x:8,y:11},{x:9,y:11},{x:9,y:12},{x:9,y:13},{x:12,y:11},{x:12,y:13},{x:12,y:12},{x:13,y:11},{x:14,y:11},{x:15,y:11},{x:16,y:11},{x:16,y:12},{x:16,y:13},{x:3,y:11},{x:2,y:11},{x:1,y:11},{x:3,y:12},{x:3,y:13},{x:3,y:14},{x:3,y:15},{x:3,y:16},{x:3,y:17},{x:2,y:17},{x:1,y:17},{x:17,y:2},{x:18,y:2},{x:16,y:2},{x:16,y:3},{x:16,y:4},{x:16,y:5},{x:16,y:6},{x:16,y:7},{x:16,y:8},{x:17,y:8},{x:18,y:8},{x:14,y:6},{x:14,y:7},{x:14,y:8},{x:13,y:8},{x:12,y:8},{x:11,y:8},{x:10,y:8},{x:10,y:7},{x:10,y:6},{x:7,y:7},{x:7,y:6},{x:3,y:8},{x:3,y:7},{x:3,y:6},{x:18,y:18},{x:17,y:18},{x:16,y:18},{x:16,y:17},{x:16,y:16},{x:16,y:15},{x:17,y:15},{x:18,y:15},{x:3,y:4},{x:4,y:4},{x:4,y:1},{x:3,y:1},{x:2,y:1},{x:2,y:4},{x:4,y:2},{x:4,y:3},{x:1,y:1},{x:1,y:4},{x:0,y:7},{x:0,y:8},{x:19,y:11},{x:19,y:12},{x:19,y:13},{x:0,y:6},{x:0,y:19},{x:19,y:0}]},aiSpawner:{x:10,y:16}},{name:"Raid",data:{redFlag:{x:1,y:14},blueFlag:{x:5,y:18},obstacles:[{x:2,y:15},{x:3,y:15},{x:3,y:16},{x:3,y:17},{x:3,y:18},{x:2,y:19},{x:2,y:18},{x:2,y:17},{x:2,y:16},{x:1,y:16},{x:0,y:17},{x:1,y:17},{x:1,y:18},{x:0,y:19},{x:4,y:15},{x:3,y:14},{x:4,y:14},{x:4,y:16},{x:3,y:13},{x:4,y:13},{x:3,y:12},{x:4,y:12},{x:3,y:11},{x:4,y:11},{x:5,y:11},{x:5,y:12},{x:5,y:13},{x:6,y:14},{x:5,y:14},{x:5,y:15},{x:5,y:16},{x:4,y:17},{x:6,y:15},{x:6,y:16},{x:7,y:14},{x:8,y:14},{x:9,y:14},{x:9,y:15},{x:9,y:16},{x:7,y:16},{x:8,y:16},{x:8,y:15},{x:7,y:15},{x:0,y:18},{x:1,y:19},{x:4,y:10},{x:5,y:10},{x:5,y:9},{x:10,y:15},{x:10,y:14},{x:11,y:14},{x:10,y:12},{x:11,y:11},{x:12,y:10},{x:13,y:9},{x:10,y:11},{x:11,y:10},{x:12,y:9},{x:7,y:9},{x:8,y:8},{x:9,y:7},{x:10,y:6},{x:9,y:8},{x:8,y:9},{x:10,y:7},{x:11,y:6},{x:11,y:5},{x:14,y:8},{x:13,y:8},{x:7,y:12},{x:7,y:13},{x:6,y:13},{x:6,y:12},{x:13,y:6},{x:13,y:5},{x:14,y:6},{x:15,y:4},{x:15,y:3},{x:16,y:4},{x:16,y:1},{x:17,y:2},{x:18,y:3},{x:18,y:2},{x:17,y:1},{x:12,y:3},{x:13,y:3},{x:13,y:2},{x:12,y:2},{x:16,y:6},{x:16,y:7},{x:17,y:7},{x:17,y:6},{x:3,y:7},{x:4,y:6},{x:5,y:5},{x:6,y:4},{x:7,y:3},{x:8,y:2},{x:3,y:10},{x:4,y:9},{x:5,y:8},{x:3,y:6},{x:4,y:5},{x:5,y:4},{x:6,y:3},{x:7,y:2},{x:14,y:15},{x:15,y:14},{x:16,y:13},{x:17,y:12},{x:13,y:16},{x:12,y:16},{x:13,y:15},{x:14,y:14},{x:15,y:13},{x:16,y:12},{x:17,y:11},{x:2,y:3},{x:2,y:2},{x:2,y:1},{x:3,y:1},{x:4,y:1},{x:3,y:2},{x:1,y:4},{x:1,y:3},{x:1,y:2},{x:1,y:1},{x:18,y:18},{x:17,y:18},{x:16,y:18},{x:15,y:18},{x:18,y:17},{x:18,y:16},{x:18,y:15},{x:17,y:16},{x:16,y:17},{x:17,y:17},{x:8,y:11},{x:7,y:11},{x:8,y:12}]},aiSpawner:{x:1,y:13}},{name:"Arena",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:1,y:14},{x:2,y:14},{x:2,y:15},{x:3,y:15},{x:3,y:16},{x:4,y:16},{x:4,y:17},{x:5,y:17},{x:5,y:18},{x:0,y:9},{x:1,y:9},{x:1,y:10},{x:2,y:10},{x:2,y:11},{x:10,y:19},{x:10,y:18},{x:9,y:18},{x:9,y:17},{x:8,y:17},{x:16,y:3},{x:16,y:4},{x:15,y:3},{x:17,y:4},{x:17,y:5},{x:18,y:5},{x:15,y:2},{x:14,y:2},{x:14,y:1},{x:17,y:8},{x:17,y:9},{x:18,y:9},{x:18,y:10},{x:19,y:10},{x:11,y:2},{x:10,y:2},{x:10,y:1},{x:9,y:1},{x:9,y:0},{x:6,y:9},{x:6,y:12},{x:9,y:6},{x:12,y:6},{x:7,y:13},{x:13,y:7},{x:14,y:14},{x:15,y:15},{x:16,y:16},{x:17,y:17},{x:5,y:5},{x:4,y:4},{x:3,y:3},{x:2,y:2},{x:10,y:13},{x:13,y:10}]},aiSpawner:{x:1,y:18}}];!function(e){e[e.PLAYER_VS_PLAYER_LOCAL=0]="PLAYER_VS_PLAYER_LOCAL",e[e.PLAYER_VS_AI=1]="PLAYER_VS_AI",e[e.AI_VS_AI=2]="AI_VS_AI"}(I||(I={})),function(e){e.WEAK="Weak",e.MEDIUM="Medium",e.STRONG="Strong"}(w||(w={}));I.PLAYER_VS_PLAYER_LOCAL,new Map([[0,4],[1,4]]),w.WEAK;var re=8,ie=2,oe=function(){function e(e,t){this.startPt=e,this.direction=t}return e.prototype.pointAtDistance=function(e){return this.startPt.add(this.direction.multiplyScaler(e))},e}(),se=function(e,t,n){this.startPt=e,this.endPt=t,this.normal=n};var le=function(){function e(e,t){this.m=e,this.b=t}return e.from=function(t,n){var a=(n.y-t.y)/(n.x-t.x);return new e(a,-a*t.x+t.y)},e.prototype.isVertical=function(){return!isFinite(this.m)},e.prototype.getYvalueAtX=function(e){return this.m*e+this.b},e}();function ce(e,t){var n=e.startPt,a=e.direction,r=a.getNormalVectorClockwise(),i=t.startPt,o=t.endPt,s=i.subtract(n),l=o.subtract(n);if(!function(e,t){if(e>0&&t<0||e<0&&t>0)return!0;return xe(e)&&!xe(t)||xe(t)&&!xe(e)}(r.dot(s),r.dot(l)))return{isCollision:!1};var c,h=le.from(e.startPt,e.startPt.add(e.direction)),u=le.from(t.startPt,t.endPt);if(u.isVertical()){var x=h.getYvalueAtX(i.x);c=new y(i.x,x)}else if(h.isVertical()){x=u.getYvalueAtX(n.x);c=new y(n.x,x)}else{var d=(u.b-h.b)/(h.m-u.m),f=h.getYvalueAtX(d);c=new y(d,f)}var g=c.subtract(n);return a.dot(g)<0?{isCollision:!1}:{isCollision:!0,collisionPt:c}}var ye,he,ue;function xe(e){return Math.abs(e)<1e-6}!function(e){e[e.BULLET=0]="BULLET",e[e.SPLASH=1]="SPLASH"}(ye||(ye={})),function(e){e.CIRCLE="Circle",e.RECTANGLE="Rectangle"}(he||(he={})),function(e){e.SELECT_CHARACTER_CLASS="SELECT_CHARACTER_CLASS",e.SELECT_TILE="SELECT_TILE",e.SELECT_CHARACTER="SELECT_CHARACTER",e.SELECT_CHARACTER_STATE="SELECT_CHARACTER_STATE",e.AIM="AIM",e.SHOOT="SHOOT",e.HEAL="HEAL",e.END_CHARACTER_TURN="END_CHARACTER_TURN"}(ue||(ue={}));var de,fe;!function(e){e[e.HEAL=0]="HEAL",e[e.THROW_GRENADE=1]="THROW_GRENADE"}(de||(de={})),function(e){e.SCOUT="Scout",e.ASSAULT="Assault",e.SNIPER="Sniper",e.DEMOLITION="Demolition"}(fe||(fe={}));var ge,me={abilityType:de.HEAL,healAmount:3,maxUses:2,cooldownTurns:2,isFree:!0},pe={abilityType:de.HEAL,healAmount:5,maxUses:2,cooldownTurns:3,isFree:!1},Te={abilityType:de.HEAL,healAmount:15,maxUses:1,cooldownTurns:0,isFree:!1},ve={abilityType:de.THROW_GRENADE,splashDamage:{type:ye.SPLASH,numRicochets:0,damage:5,damageManhattanDistanceRadius:1,tilesAwayDamageReduction:.6,projectileSpeed:E.TILE_SIZE/160,color:"#176107",shape:{type:he.CIRCLE,radius:E.TILE_SIZE/6}},maxManhattanDistance:4,maxUses:1,cooldownTurns:0,isFree:!1},Se={abilityType:de.THROW_GRENADE,splashDamage:{type:ye.SPLASH,numRicochets:0,damage:8,damageManhattanDistanceRadius:3,tilesAwayDamageReduction:.5,projectileSpeed:E.TILE_SIZE/160,color:"#176107",shape:{type:he.CIRCLE,radius:E.TILE_SIZE/6}},maxManhattanDistance:4,maxUses:1,cooldownTurns:0,isFree:!1},Ce={canFireAfterMoving:!0,projectileDetails:{type:ye.BULLET,numRicochets:1,damage:3,projectileSpeed:E.TILE_SIZE/80,color:"#fff86e",shape:{type:he.CIRCLE,radius:E.TILE_SIZE/16}},aimIndicatorLength:.75*E.TILE_SIZE,spray:{projectiles:3,offsetAngleRadians:Math.PI/24}},Ee={canFireAfterMoving:!0,projectileDetails:{type:ye.BULLET,numRicochets:2,damage:6,projectileSpeed:E.TILE_SIZE/80,color:"#fff86e",shape:{type:he.CIRCLE,radius:E.TILE_SIZE/12}},aimIndicatorLength:1.5*E.TILE_SIZE},Ae={canFireAfterMoving:!1,projectileDetails:{type:ye.BULLET,numRicochets:5,damage:8,projectileSpeed:E.TILE_SIZE/60,color:"#fff86e",shape:{type:he.RECTANGLE,size:new y(E.TILE_SIZE/4,E.TILE_SIZE/8)}},aimIndicatorLength:12*E.TILE_SIZE},Ie={canFireAfterMoving:!0,projectileDetails:{type:ye.SPLASH,numRicochets:0,damage:10,damageManhattanDistanceRadius:2,tilesAwayDamageReduction:.6,projectileSpeed:E.TILE_SIZE/160,color:"#f2ebeb",shape:{type:he.RECTANGLE,size:new y(E.TILE_SIZE/4,E.TILE_SIZE/8)}},aimIndicatorLength:.75*E.TILE_SIZE},we={type:fe.SCOUT,maxHealth:8,maxMovesPerTurn:6,maxSight:8,gun:Ce,extraActions:new Set([me,ve])},Le={type:fe.ASSAULT,maxHealth:12,maxMovesPerTurn:4,maxSight:6,gun:Ee,extraActions:new Set([pe,ve])},be=[we,Le,{type:fe.SNIPER,maxHealth:8,maxSight:8,maxMovesPerTurn:3,gun:Ae,extraActions:new Set([Te])},{type:fe.DEMOLITION,maxHealth:12,maxSight:4,maxMovesPerTurn:3,gun:Ie,extraActions:new Set([Te,Se])}],Me=function(){function e(e){var t=e.tileCoords,n=e.teamIndex;this.startTileCoords=t,this.tileCoords=t,this.teamIndex=n}return e.prototype.setIsTaken=function(e){this.isTaken=!0,this.getTileTopLeft=e},e.prototype.isAtStart=function(){return this.startTileCoords.equals(this.tileCoords)},e.prototype.returnToStart=function(){this.setDropped(),this.tileCoords=this.startTileCoords},e.prototype.setDropped=function(){this.isTaken=!1,this.getTileTopLeft=void 0},e.prototype.getCurrentTile=function(){return this.isTaken?E.getTileFromCanvasCoords(this.getTileTopLeft()):this.tileCoords},e.prototype.update=function(e){},e.prototype.render=function(e){var t=E.getCanvasFromTileCoords(this.tileCoords);this.isTaken&&(t=this.getTileTopLeft());var n=.2*E.TILE_SIZE,a=.1*E.TILE_SIZE,r=a;e.fillStyle=F,e.fillRect(t.x+a,t.y+n,r,E.TILE_SIZE-n);var i=a,o=.36*E.TILE_SIZE;e.fillStyle=0===this.teamIndex?O:k,e.fillRect(t.x+a+r,t.y+n,E.TILE_SIZE-a-r-i,o)},e}(),Re=3*E.TILE_SIZE,_e=2*Math.PI,Pe=function(){function e(e){if(this.context=e.context,this.projectileDetails=e.projectileDetails,0===e.targets.length)throw new Error("Created a projectile with no targets");this.setNewTargets(e.targets),this.tileCoords=E.getTileFromCanvasCoords(this.animationState.currentTarget.ray.startPt),this.trails=[{ray:this.animationState.currentTarget.ray,distance:0,maxDistance:this.animationState.currentTarget.maxDistance}],this.fromTeamIndex=e.fromTeamIndex,this.timesRicocheted=0,this.isDead=!1}return e.prototype.update=function(e){var t,n,a=this.animationState.currentTarget,r=a.ray.direction.multiplyScaler(this.animationState.movementSpeedMs*e),o=r.getMagnitude();try{for(var s=i(this.trails),l=s.next();!l.done;l=s.next()){l.value.distance+=o}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}this.animationState.isAnimating&&(this.animationState.currentCenterCanvas=this.animationState.currentCenterCanvas.add(r),this.tileCoords=E.getTileFromCanvasCoords(this.animationState.currentCenterCanvas),a.ray.startPt.distanceTo(this.animationState.currentCenterCanvas)<a.maxDistance||(this.animationState.currentCenterCanvas=this.animationState.currentTarget.canvasCoords,0!==this.animationState.remainingTargets.length?(this.animationState.currentTarget=this.animationState.remainingTargets.shift(),this.trails.push({ray:this.animationState.currentTarget.ray,distance:0,maxDistance:this.animationState.currentTarget.maxDistance}),this.timesRicocheted+=1):this.animationState.isAnimating=!1))},e.prototype.isAtFinalTarget=function(){return!this.isDead&&!this.animationState.isAnimating},e.prototype.setNewTargets=function(e){var t=e.shift(),n=e,a=null!=this.animationState?this.animationState.currentCenterCanvas:t.ray.startPt;this.animationState={movementSpeedMs:this.projectileDetails.projectileSpeed,currentCenterCanvas:a,isAnimating:!0,currentTarget:t,remainingTargets:n}},e.prototype.getCurrentTarget=function(){return this.animationState.currentTarget},e.prototype.getNumRicochetsLeft=function(){return this.projectileDetails.type===ye.BULLET?this.projectileDetails.numRicochets-this.timesRicocheted:0},e.prototype.setIsDead=function(){this.isDead=!0},e.prototype.isTrailGone=function(){return this.trails.every((function(e){return e.distance>e.maxDistance+Re}))},e.prototype.render=function(){var e,t,n,a=this.context,r=this.projectileDetails.shape;n=r.type===he.CIRCLE?r.radius:r.size.x;try{for(var o=i(this.trails),s=o.next();!s.done;s=o.next()){var l=s.value;if(!(l.distance<n||l.distance>l.maxDistance+Re)){var c=l.ray.direction.multiplyScaler(-1),y=0,h=l.ray.pointAtDistance(l.distance),u=h;l.distance>l.maxDistance&&(y=Re-(l.distance-l.maxDistance),u=l.ray.pointAtDistance(l.maxDistance));var x=Math.min(Re,l.distance,l.distance+y),d=h.add(c.multiplyScaler(x)),f=a.createLinearGradient(h.x,h.y,d.x,d.y),g=q,m=q+"00";f.addColorStop(0,g),f.addColorStop(1,m),a.strokeStyle=f,a.beginPath(),a.moveTo(u.x,u.y),a.lineTo(d.x,d.y),a.closePath(),a.stroke()}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(!this.isDead){var p=this.animationState.currentCenterCanvas;switch(a.fillStyle=this.projectileDetails.color,r.type){case he.CIRCLE:var T=r.radius;a.beginPath(),a.arc(p.x,p.y,T,0,_e),a.closePath(),a.fill();break;case he.RECTANGLE:var v=r.size,S=this.getCurrentTarget().ray.direction,C=S.getNormalVectorClockwise(),E=S.multiplyScaler(-v.x/2),A=S.multiplyScaler(v.x/2),I=C.multiplyScaler(-v.y/2),w=C.multiplyScaler(v.y/2),L=p.add(E).add(I),b=p.add(A).add(I),M=p.add(A).add(w),R=p.add(E).add(w);a.beginPath(),a.moveTo(L.x,L.y),a.lineTo(b.x,b.y),a.lineTo(M.x,M.y),a.lineTo(R.x,R.y),a.closePath(),a.fill();break;default:throw new Error("Unknown projectile shape")}}},e}();function De(e,t,n){return(t-e)*n+e}function Fe(e){var t=e.length>7?parseInt(e.substring(7,9),16)/255:1;return{r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16),a:t}}function ke(e){return"rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")"}!function(e){e.CIRCLE="Circle",e.ELLIPSE="Ellipse",e.LINE="Line",e.PLUS="Plus"}(ge||(ge={}));var Oe,Ne,He=2*Math.PI,Ge=function(){function e(e){this.params=e,this.particles=[],this.isAlive=!0,this.tileCoords=E.getTileFromCanvasCoords(e.startPositionCanvas);for(var t,n,a,r=He/e.particleCount,i=0;i<e.particleCount;i++){var o=i*r,s=new y(Math.cos(o),Math.sin(o)).normalize(),l=De(e.minParticleSpeed,e.maxParticleSpeed,Math.random()),c=De(e.minLifetimeMs,e.maxLifetimeMs,Math.random()),h=(t=Fe(e.colorA),n=Fe(e.colorB),a=Math.random(),{r:De(t.r,n.r,a),g:De(t.g,n.g,a),b:De(t.b,n.b,a),a:De(t.a,n.a,a)}),u=De(e.minRadius,e.maxRadius,Math.random()),x=this.params.shape===ge.ELLIPSE?s.getPointRotationRadians():0;this.particles.push({canvasPosition:e.startPositionCanvas,direction:s,lifetimeMs:c,deltaPositionPerMs:l,color:ke(h),shape:this.params.shape,radius:u,rotationRadians:x})}}return e.prototype.update=function(e){var t=!1;this.particles.forEach((function(n){n.lifetimeMs-=e,n.lifetimeMs>0&&(t=!0,n.canvasPosition=n.canvasPosition.add(n.direction.multiplyScaler(n.deltaPositionPerMs*e)))})),this.isAlive=t},e.prototype.render=function(e){this.particles.forEach((function(t){if(!(t.lifetimeMs<=0)){var n=t.canvasPosition;switch(t.shape){case ge.CIRCLE:e.fillStyle=t.color,e.beginPath(),e.arc(n.x,n.y,t.radius,0,He),e.fill();break;case ge.LINE:e.strokeStyle=t.color,e.lineWidth=1,e.beginPath();var a=t.direction.multiplyScaler(t.radius),r=n.add(a),i=n.subtract(a);e.moveTo(r.x,r.y),e.lineTo(i.x,i.y),e.stroke();break;case ge.ELLIPSE:e.fillStyle=t.color,e.beginPath();var o=t.radius,s=t.radius/2;e.ellipse(n.x,n.y,o,s,t.rotationRadians,0,He),e.fill();break;case ge.PLUS:e.fillStyle=t.color;var l=t.radius,c=l/4,h=t.canvasPosition.subtract(new y(l,c));e.fillRect(h.x,h.y,2*l,2*c);var u=t.canvasPosition.subtract(new y(c,l));e.fillRect(u.x,u.y,2*c,2*l)}}}))},e}();!function(e){e[e.SHORT=0]="SHORT",e[e.LONG=1]="LONG"}(Oe||(Oe={})),function(e){e[e.TITLE=0]="TITLE",e[e.SUBTITLE=1]="SUBTITLE",e[e.TOAST=2]="TOAST"}(Ne||(Ne={}));var Be=new Map([[Oe.SHORT,2e3],[Oe.LONG,4e3]]),We=new Map([[Ne.TITLE,{fontSize:72,topMargin:E.GAME_HEIGHT/4}],[Ne.SUBTITLE,{fontSize:48,topMargin:E.GAME_HEIGHT/2}],[Ne.TOAST,{fontSize:24,topMargin:7*E.GAME_HEIGHT/8}]]),Ue=function(){function e(e){this.context=e,this.isShowingControlMap=!1,this.titleMsLeft=-1,this.subtitleMsLeft=-1,this.toastMsLeft=-1}return e.prototype.update=function(e){this.titleMsLeft>0&&(this.titleMsLeft-=e),this.subtitleMsLeft>0&&(this.subtitleMsLeft-=e),this.toastMsLeft>0&&(this.toastMsLeft-=e)},e.prototype.render=function(){if(this.titleMsLeft>0){if(!this.titleText)throw new Error("Expected title text to set when titleMsLeft > 0");this.renderText(this.titleText,We.get(Ne.TITLE),this.titleMsLeft/Be.get(this.titleDuration))}if(this.subtitleMsLeft>0){if(!this.subtitleText)throw new Error("Expected subtitle text to set when subtitleMsLeft > 0");this.renderText(this.subtitleText,We.get(Ne.SUBTITLE),this.subtitleMsLeft/Be.get(this.subtitleDuration))}if(this.toastMsLeft>0){if(!this.toastText)throw new Error("Expected toastText text to set when toastMsLeft > 0");this.renderText(this.toastText,We.get(Ne.TOAST),this.toastMsLeft/Be.get(this.toastDuration))}},e.prototype.setText=function(e,t,n){var a=Be.get(n);switch(t){case Ne.TITLE:this.titleText=e,this.titleMsLeft=a,this.titleDuration=n;break;case Ne.SUBTITLE:this.subtitleText=e,this.subtitleMsLeft=a,this.subtitleDuration=n;break;case Ne.TOAST:this.toastText=e,this.toastMsLeft=a,this.toastDuration=n}},e.prototype.clearText=function(e){switch(e){case Ne.TITLE:this.titleText="",this.titleMsLeft=0;break;case Ne.SUBTITLE:this.subtitleText="",this.subtitleMsLeft=0;break;case Ne.TOAST:this.toastText="",this.toastMsLeft=0}},e.prototype.renderText=function(e,t,n){var a=Fe(R);a.a=n,this.context.fillStyle=ke(a),this.context.font=t.fontSize+"px fantasy";var r=this.context.measureText(e).width,i=new y(E.GAME_WIDTH/2,t.topMargin);this.context.fillText(e,i.x-r/2,i.y-t.fontSize/2)},e}(),ze=n.p+"7b84303c217de9c4be4e53d998b5d30a.jpg",Ze=function(){function e(e){var t=this;this.image=new Image,this.image.onload=function(){t.isLoaded=!0},this.image.src=e}return e.prototype.tryDrawing=function(e){this.isLoaded&&e.context.drawImage(this.image,e.sourceX,e.sourceY,e.sourceWidth,e.sourceHeight,e.canvasX,e.canvasY,e.canvasWidth,e.canvasHeight)},e}(),qe=function(){function e(e){this.texture=new Ze(ze),this.tileCoords=e}return e.prototype.update=function(e){},e.prototype.render=function(e){var t=E.getCanvasFromTileCoords(this.tileCoords);e.fillStyle=D,e.fillRect(t.x,t.y,E.TILE_SIZE,E.TILE_SIZE),P&&this.texture.tryDrawing({context:e,sourceX:t.x,sourceY:t.y,sourceWidth:E.TILE_SIZE,sourceHeight:E.TILE_SIZE,canvasX:t.x,canvasY:t.y,canvasWidth:E.TILE_SIZE,canvasHeight:E.TILE_SIZE})},e.prototype.getEdges=function(){var e=E.getCanvasFromTileCoords(this.tileCoords),t=e.add(new y(E.TILE_SIZE,0)),n=e.add(new y(0,E.TILE_SIZE)),a=e.add(new y(E.TILE_SIZE,E.TILE_SIZE));return[new se(e,t,new y(0,-1)),new se(t,a,new y(1,0)),new se(n,a,new y(0,1)),new se(e,n,new y(-1,0))]},e}();function je(e){return new oe(e.fromCanvasCoords,new y(Math.cos(e.aimAngleRadiansClockwise),Math.sin(e.aimAngleRadiansClockwise)))}function Ke(e){for(var t=e.ray,n=e.fromTeamIndex,a=e.startingTileCoords,r=e.numRicochets,i=e.characters,o=e.obstacles,s=[],l=r+1,c=a,y=t,h=!1,u=function(t){return null!=i.filter((function(t){return t.teamIndex!==e.fromTeamIndex})).find((function(e){return e.tileCoords.equals(t.tile)}))};l>0&&!h;){var x=Ve({ray:y,startTile:c,fromTeamIndex:n,obstacles:o,characters:i});s.push(x),h=u(x),l-=1;var d=y.direction.reflect(x.normal);y=new oe(x.canvasCoords,d),c=x.tile,x.isTargetGridBorder&&(h=!1,c=E.getTileFromCanvasCoords(x.canvasCoords.add(x.normal.multiplyScaler(-E.TILE_SIZE/2))))}return s}function Ve(e){var t=e.ray,n=e.fromTeamIndex,a=e.startTile,r=function(e){var t,n,a=new y(0,0),r=a.add(new y(E.GAME_WIDTH,0)),o=a.add(new y(0,E.GAME_HEIGHT)),s=r.add(o),l=new se(a,o,new y(1,0)),c=new se(a,r,new y(0,1)),h=new se(r,s,new y(-1,0)),u=new se(o,s,new y(0,-1)),x=[l,c,h,u],d=null,f=null,g=null;try{for(var m=i(x),p=m.next();!p.done;p=m.next()){var T=p.value,v=ce(e,T);if(v.isCollision){var S=(g=T.normal).multiplyScaler(.05*E.TILE_SIZE);d=v.collisionPt.add(S),f=E.getTileFromCanvasCoords(d);break}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(n=m.return)&&n.call(m)}finally{if(t)throw t.error}}if(null==d){ce(e,u),ce(e,h);throw new Error("Shot ray does not intersect with any Grid")}var C=function(e){return Math.abs(e.x-d.x)<.1*E.TILE_SIZE&&Math.abs(e.y-d.y)<.1*E.TILE_SIZE},A=.05*E.TILE_SIZE;C(a)?d=d.add(new y(A,A)):C(r)?d=d.add(new y(-A,A)):C(o)?d=d.add(new y(A,-A)):C(s)&&(d=d.add(new y(-A,-A)));return{normal:g,ray:e,isTargetGridBorder:!0,canvasCoords:d,tile:f,maxDistance:e.startPt.distanceTo(d)}}(t),o=function(e){var t,n,a=3*E.TILE_SIZE/4,r=a,o=e.startTile.toString(),s=new Set([o]),l=null,c=null,y=e.maxDistance,u=null,x=e.ray,d=e.obstacles.map((function(e){return e.tileCoords})).concat(e.characters.map((function(e){return e.tileCoords})));for(;r<e.maxDistance;){var f=E.getTileFromCanvasCoords(e.ray.pointAtDistance(r)),g=[f].concat(E.getAdjacentTiles(f)).filter((function(e){return!s.has(e.toString())})),m=function(t){var n,a,r,o;if(s.add(t.toString()),!h(t,d))return"continue";var f=e.obstacles.find((function(e){return e.tileCoords.equals(t)}));if(f){var g=f.getEdges().filter((function(e){return e.normal.dot(x.direction)<=0}));try{for(var m=(n=void 0,i(g)),p=m.next();!p.done;p=m.next()){var T=p.value;if((E=ce(x,T)).isCollision)(A=x.startPt.distanceTo(E.collisionPt))<y&&(y=A,c=t,l=E.collisionPt,u=T.normal)}}catch(e){n={error:e}}finally{try{p&&!p.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}}else{var v=e.characters.find((function(e){return e.tileCoords.equals(t)}));if(!v)throw new Error("Tile is occupied but no obstacle or character...");if(v.teamIndex===e.fromTeamIndex)return"continue";try{for(var S=(r=void 0,i(v.getEdges())),C=S.next();!C.done;C=S.next()){var E,A;T=C.value;if((E=ce(x,T)).isCollision)(A=x.startPt.distanceTo(E.collisionPt))<y&&(y=A,c=t,l=E.collisionPt,u=T.normal)}}catch(e){r={error:e}}finally{try{C&&!C.done&&(o=S.return)&&o.call(S)}finally{if(r)throw r.error}}}};try{for(var p=(t=void 0,i(g)),T=p.next();!T.done;T=p.next()){var v=T.value;m(v)}}catch(e){t={error:e}}finally{try{T&&!T.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}if(null!=l)break;r+=a}if(null!=c){return{normal:u,isTargetGridBorder:!1,ray:x,tile:c,canvasCoords:l,maxDistance:y}}return null}({startTile:a,ray:t,obstacles:e.obstacles,characters:e.characters,maxDistance:t.startPt.distanceTo(r.canvasCoords),fromTeamIndex:n});return null!=o?o:r}var Ye,Qe,Xe=2*Math.PI,Je=E.TILE_SIZE/4,$e=function(){function e(e){var t,n;this.gameDelegate=e.gameDelegate,this.tileCoords=e.startCoords,this.animationState={movementSpeedMs:.005*E.TILE_SIZE,isAnimating:!1,remainingTargets:[],currentCenterCanvas:E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE)},this.teamIndex=e.teamIndex,this.index=e.index,this.settings=e.settings,this.health=this.settings.maxHealth,this.hasMoved=!1,this.characterAbilityTypeToAbilityState=new Map;try{for(var a=i(this.settings.extraActions),r=a.next();!r.done;r=a.next()){var o=r.value,s={cooldownTurnsLeft:0};0!==o.maxUses&&(s.usesLeft=o.maxUses),this.characterAbilityTypeToAbilityState.set(o.abilityType,s)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this.isAiming=!1,this.aimAngleRadiansClockwise=0,this.calculateTargetPath(),this.resetTurnState()}return e.prototype.render=function(e){var t,n,a=this.animationState.currentCenterCanvas.subtract(E.HALF_TILE),r=this.animationState.currentCenterCanvas;e.fillStyle=this.getCharacterColor(),e.beginPath(),e.arc(r.x,r.y,Je,0,Xe),e.closePath(),e.fill();var o=a.add(new y(0,E.TILE_SIZE)),s=""+(this.index+1);e.fillStyle=M;var l=new y(E.TILE_SIZE/12,E.TILE_SIZE/12);e.font="12px fantasy",e.fillText(s,o.x+l.x,o.y-l.y);var c=E.TILE_SIZE/10,h=2*Je+c,u=this.health/this.settings.maxHealth,x=r.add(new y(-h/2,-Je-2*c)),d=h*u;switch(e.fillStyle=j,e.fillRect(x.x,x.y,d,c),this.health!==this.settings.maxHealth&&(e.fillStyle=K,e.fillRect(x.x+d,x.y,h-d,c)),this.settings.type){case fe.SCOUT:var f=.75*Je,g=.75*Je,m=.75*Je,p=g/2,T=r.add(new y(-f,-g/2));e.fillStyle="#804526",e.fillRect(T.x,T.y,f,g),e.fillRect(r.x,r.y,m,p);break;case fe.ASSAULT:e.fillStyle="#e8d100";var v=.6*Je,S=.4*Je,C=function(t){var n,a;e.beginPath(),e.moveTo(t.x,t.y);var r=[new y(0,-S/2),new y(v/2,-S),new y(v,-S/2),new y(v,0),new y(v/2,-S/2)];try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var l=s.value,c=t.add(l);e.lineTo(c.x,c.y)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}e.closePath(),e.fill()},A=r.add(new y(-v/2,0)),I=A.add(new y(0,1.5*S));C(A),C(I);break;case fe.SNIPER:e.strokeStyle="#1d1570",e.fillStyle="#1d1570";var w=.7*Je,L=2*w,b=.2*Je,R=r.add(new y(-L/2,-b/2));e.fillRect(R.x,R.y,L,b);var _=r.add(new y(-b/2,-L/2));e.fillRect(_.x,_.y,b,L),e.beginPath(),e.arc(r.x,r.y,w,0,Xe),e.closePath(),e.stroke();break;case fe.DEMOLITION:var P=.75*Je,D=.85*Je,F=r.add(new y(-P/2,0)),k=e.createLinearGradient(F.x,F.y-D,F.x+P,F.y);k.addColorStop(0,"#f74d40"),k.addColorStop(1,"#e8ba3c"),e.fillStyle=k,function(t){var n,a;e.beginPath(),e.moveTo(t.x,t.y);var r=[new y(P/4,-D/4),new y(P/2,-D/2),new y(P,-D/4),new y(P,0),new y(3*P/4,D/2),new y(P/4,D/2)];try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var l=s.value,c=t.add(l);e.lineTo(c.x,c.y)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}e.closePath(),e.fill()}(F)}if(this.isAiming){e.strokeStyle=Z;var O=this.settings.gun.aimIndicatorLength,N=r,H=0;e.beginPath(),e.moveTo(N.x,N.y);try{for(var G=i(this.aimPath),B=G.next();!B.done;B=G.next()){var W=B.value.canvasCoords,U=N.distanceTo(W),z=U+H>O;if(z){var q=W.subtract(N).normalize().multiplyScaler(O-H);W=N.add(q)}if(e.lineTo(W.x,W.y),N=W,H+=U,z)break}}catch(e){t={error:e}}finally{try{B&&!B.done&&(n=G.return)&&n.call(G)}finally{if(t)throw t.error}}e.stroke()}},e.prototype.getCurrentTile=function(){return this.animationState.isAnimating?E.getTileFromCanvasCoords(this.animationState.currentCenterCanvas):this.tileCoords},e.prototype.moveTo=function(e,t){if(this.isFinishedWithTurn||this.hasMoved)throw new Error("Already moved.");this.animationState.currentCenterCanvas=E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE),this.animationState.currentTarget=t.shift(),this.tileCoords=e,this.animationState.remainingTargets=t,this.animationState.isAnimating=!0,this.hasMoved=!0,this.checkAndSetTurnOver()},e.prototype.update=function(e){if(this.isAiming&&this.calculateTargetPath(),this.animationState.isAnimating){var t=this.animationState.currentTarget,n=t.ray.direction.multiplyScaler(this.animationState.movementSpeedMs*e);n.getMagnitude();this.animationState.currentCenterCanvas=this.animationState.currentCenterCanvas.add(n),t.ray.startPt.distanceTo(this.animationState.currentCenterCanvas)<t.maxDistance||(this.animationState.currentCenterCanvas=t.canvasCoords,0!==this.animationState.remainingTargets.length?this.animationState.currentTarget=this.animationState.remainingTargets.shift():this.animationState.isAnimating=!1)}},e.prototype.skipAnimation=function(){var e=this.animationState.remainingTargets,t=e.length-1,n=e.length>0?this.animationState.remainingTargets[t]:this.animationState.currentTarget;this.animationState.currentCenterCanvas=n.canvasCoords,this.animationState.remainingTargets=[],this.animationState.isAnimating=!1},e.prototype.isAlive=function(){return this.health>0},e.prototype.startAiming=function(){if(!this.canShoot())throw new Error("Already shot or used non-free action.");this.isAiming=!0},e.prototype.cancelAiming=function(){this.isAiming=!1},e.prototype.setAim=function(e){this.aimAngleRadiansClockwise=e},e.prototype.getAim=function(){return this.aimAngleRadiansClockwise},e.prototype.calculateTargetPath=function(){this.aimPath=this.gameDelegate.getCurrentAimPath({ray:je(this.getCurrentShotInfo()[0]),startingTileCoords:this.tileCoords,fromTeamIndex:this.teamIndex,numRicochets:this.settings.gun.projectileDetails.numRicochets})},e.prototype.shoot=function(){if(!this.canShoot())throw new Error("Already shot or used non - free action.");return this.isAiming=!1,this.hasShot=!0,this.extraAbilities=this.extraAbilities.filter((function(e){return e.isFree})),this.checkAndSetTurnOver(),this.getCurrentShotInfo()},e.prototype.getCurrentShotInfo=function(){var e=E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE),t=[{fromTeamIndex:this.teamIndex,fromTileCoords:this.tileCoords,fromCanvasCoords:e,aimAngleRadiansClockwise:this.aimAngleRadiansClockwise,projectileDetails:this.settings.gun.projectileDetails}];if(this.settings.gun.spray)for(var n=this.settings.gun.spray;t.length<n.projectiles;){var a=t.length%2==0?1:-1,r=this.aimAngleRadiansClockwise+n.offsetAngleRadians*a;t.push({fromTeamIndex:this.teamIndex,fromTileCoords:this.tileCoords,fromCanvasCoords:e,aimAngleRadiansClockwise:r,projectileDetails:this.settings.gun.projectileDetails})}return t},e.prototype.getGrenadeAbility=function(){var e=this.extraAbilities.find((function(e){return e.abilityType===de.THROW_GRENADE}));if(null==e)throw new Error("Trying to getGrenadeAction but character does not have that action");return e},e.prototype.useAbility=function(e){var t=this.extraAbilities.find((function(t){return t.abilityType===e}));if(null==t)throw new Error("Character doesn't have ability for ActionType: "+e);this.extraAbilities=this.extraAbilities.filter((function(t){return t.abilityType!==e}));var n=this.characterAbilityTypeToAbilityState.get(e);n.usesLeft&&(n.usesLeft-=1),n.cooldownTurnsLeft=s(this.settings.extraActions).find((function(e){return e.abilityType===t.abilityType})).cooldownTurns,t.isFree||(this.hasShot=!0,this.extraAbilities=this.extraAbilities.filter((function(e){return e.isFree}))),this.checkAndSetTurnOver()},e.prototype.regenHealth=function(e){this.health=Math.min(this.health+e,this.settings.maxHealth)},e.prototype.getEdges=function(){var e=E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE).subtract(new y(Je,Je)),t=e.add(new y(2*Je,0)),n=e.add(new y(0,2*Je)),a=e.add(new y(2*Je,2*Je));return[new se(e,t,new y(0,-1)),new se(t,a,new y(1,0)),new se(n,a,new y(0,1)),new se(e,n,new y(-1,0))]},e.prototype.isTurnOver=function(){return this.isFinishedWithTurn},e.prototype.setTurnOver=function(){this.isFinishedWithTurn=!0,this.isAiming=!1},e.prototype.resetTurnState=function(){var e,t;this.hasMoved=!1,this.hasShot=!1,this.extraAbilities=[];try{for(var n=i(this.settings.extraActions),a=n.next();!a.done;a=n.next()){var r=a.value,o=this.characterAbilityTypeToAbilityState.get(r.abilityType);if(!o)throw new Error("Didn't initialize characterActionsToState for "+r.abilityType);0!==o.usesLeft&&o.cooldownTurnsLeft<=0&&this.extraAbilities.push(r),o.cooldownTurnsLeft-=1}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.isFinishedWithTurn=!1},e.prototype.checkAndSetTurnOver=function(){this.isFinishedWithTurn||this.extraAbilities.some((function(e){return e.isFree}))||(!this.hasMoved||!this.hasShot&&this.settings.gun.canFireAfterMoving)&&(!this.hasShot||this.settings.gun.canFireAfterMoving)||this.setTurnOver()},e.prototype.getCharacterColor=function(){return this.isFinishedWithTurn?0===this.teamIndex?B:G:0===this.teamIndex?H:N},e.prototype.canShoot=function(){return!this.isFinishedWithTurn&&(!(!this.settings.gun.canFireAfterMoving&&this.hasMoved)&&!this.hasShot)},e}();!function(e){e[e.CHARACTER_PLACEMENT=0]="CHARACTER_PLACEMENT",e[e.COMBAT=1]="COMBAT"}(Ye||(Ye={})),function(e){e.AWAITING="AWAITING",e.MOVING="MOVING",e.AIMING="AIMING",e.THROWING_GRENADE="THROWING_GRENADE"}(Qe||(Qe={}));var et,tt=function(){function e(e){this.gamePhase=Ye.CHARACTER_PLACEMENT,this.settings=e,this.obstacles=[],this.characters=[],this.flags=[],this.currentTeamIndex=0,this.selectableTiles=[]}return e.prototype.isFogOfWarOn=function(){return null!=this.settings.hasFogOfWar&&!0===this.settings.hasFogOfWar},e.prototype.isTileVisibleByTeamIndex=function(e,t){var n,a;try{for(var r=i(this.getCharactersForTeamIndex(t)),o=r.next();!o.done;o=r.next()){var s=o.value;if(s.getCurrentTile().manhattanDistanceTo(e)<=s.settings.maxSight)return!0}}catch(e){n={error:e}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}return this.getFlagForTeamIndex(t).getCurrentTile().manhattanDistanceTo(e)<=2},e.prototype.getTilesVisibleByTeamIndex=function(e){for(var t=[],n=0;n<E.TILES_WIDE;n++)for(var a=0;a<E.TILES_TALL;a++){var r=new y(n,a);this.isTileVisibleByTeamIndex(r,e)&&t.push(r)}return t},e.prototype.getFirstCharacterIndex=function(){var e=this.getActiveSquad().filter((function(e){return!e.isTurnOver()}));if(0===e.length)throw new Error("No more characters alive - should be game over?");return e[0].index},e.prototype.getGameInfo=function(){return{characters:this.getAliveCharacters(),obstacles:this.obstacles}},e.prototype.getAliveCharacters=function(){return this.characters.filter((function(e){return e.isAlive()}))},e.prototype.getActiveTeamName=function(){switch(this.currentTeamIndex){case 0:return"Blue";case 1:return"Red";default:throw new Error("Unsupported number of teams: "+this.currentTeamIndex)}},e.prototype.getEnemyTeamName=function(){switch(this.currentTeamIndex){case 1:return"Blue";case 0:return"Red";default:throw new Error("Unsupported number of teams: "+this.currentTeamIndex)}},e.prototype.getActiveSquad=function(){var e=this;return this.getAliveCharacters().filter((function(t){return t.teamIndex===e.currentTeamIndex}))},e.prototype.getEnemyCharacters=function(){var e=this;return this.getAliveCharacters().filter((function(t){return t.teamIndex!==e.currentTeamIndex}))},e.prototype.getActiveTeamFlag=function(){var e=this;return this.flags.find((function(t){return t.teamIndex===e.currentTeamIndex}))},e.prototype.getEnemyFlag=function(){var e=this;return this.flags.find((function(t){return t.teamIndex!==e.currentTeamIndex}))},e.prototype.tileHasObstacle=function(e){return null!=this.obstacles.find((function(t){return t.tileCoords.equals(e)}))},e.prototype.enemyHasFlag=function(){var e=this.getActiveTeamFlag().tileCoords;return null!=this.getEnemyCharacters().find((function(t){return t.tileCoords.equals(e)}))},e.prototype.teamHasFlag=function(){var e=this.getEnemyFlag().tileCoords;return null!=this.getActiveSquad().find((function(t){return t.tileCoords.equals(e)}))},e.prototype.getPath=function(e){var t=this,n=function(e){return!t.tileHasObstacle(e)};return function(e){for(var t,n,a=e.startTile,r=e.endTile,o=e.isAvailable,l=e.canGoThrough,c=new Map,y=[a].map((function(e){return{parent:a,coords:e}})),h=!1;!h;){var u=y.shift();if(l(u.coords)){if(o(u.coords)&&!c.has(u.coords.toString())&&c.set(u.coords.toString(),u),u.coords.equals(r)){h=!0;break}var x=function(e){var t=c.has(e.toString()),n=null!=y.find((function(t){return t.coords.equals(e)}));t||n||!o(e)||y.push({parent:u.coords,coords:e})};try{for(var d=(t=void 0,i(E.getAdjacentTiles(u.coords))),f=d.next();!f.done;f=d.next()){x(f.value)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}}}for(var g=function(e){return s(c.values()).find((function(t){return t.coords.equals(e)}))},m=g(r),p=[];!m.coords.equals(a);)p.push(m.coords),m=g(m.parent);return p.reverse()}({startTile:e.from,endTile:e.to,isAvailable:n,canGoThrough:n})},e.prototype.isSquadMemberAtTile=function(e){var t=this;return null!=this.getActiveSquad().find((function(n){return n.isAlive()&&n.tileCoords.equals(e)&&n!==t.selectedCharacter}))},e.prototype.getCharactersForTeamIndex=function(e){return this.getAliveCharacters().filter((function(t){return t.teamIndex===e}))},e.prototype.getFlagForTeamIndex=function(e){return this.flags[e]},e}();function nt(e){return e[Math.floor(Math.random()*e.length)]}!function(e){e.TARGET_FINDING="Targets",e.AI="AI",e.ACTIONS="Actions"}(et||(et={}));var at,rt=new(function(){function e(){this.logTypeToIsLogging=new Map([[et.TARGET_FINDING,!1],[et.AI,!1],[et.ACTIONS,!1]]),this.logTypeToLogs=new Map([[et.ACTIONS,[]],[et.AI,[]],[et.TARGET_FINDING,[]]])}return e.prototype.log=function(e,t){this.logTypeToLogs.get(e).push(t),this.logTypeToIsLogging.get(e)&&console.log(t)},e}()),it={randomizeMovement:!1,maxAngleRandomization:Math.PI/18,ignoresFogOfWar:!1,characterClass:we,heals:!1},ot={randomizeMovement:!0,maxAngleRandomization:Math.PI/24,ignoresFogOfWar:!1,characterClass:Le,heals:!1},st={randomizeMovement:!0,maxAngleRandomization:0,ignoresFogOfWar:!1,characterClass:Le,heals:!1},lt=new Map([[w.WEAK,it],[w.MEDIUM,ot],[w.STRONG,st]]);!function(e){e.DEFEND="DEFEND",e.ELIMINATE="ELIMINATE",e.SNAG="SNAG"}(at||(at={}));var ct=function(){function e(e){var t=e.teamIndex,n=e.difficulty;this.teamIndex=t,this.difficulty=n,this.log("AI created on "+n+" difficulty"),this.settings=lt.get(n),this.actionQueue=[],this.characterIndexToPriority=new Map}return e.prototype.getNextAction=function(e){0===this.actionQueue.length&&(this.actionQueue=this.getActionsForGameState(e));var t=this.actionQueue.shift();if(null==t)throw new Error("AI couldn't get action to perform");var n=t(e);return null!=e.selectedCharacter&&this.log("AI: selected character index - "+e.selectedCharacter.index),this.log("AI: Taking action: "+JSON.stringify(n)),n},e.prototype.getActionsForGameState=function(e){if(e.gamePhase===Ye.CHARACTER_PLACEMENT)return this.placeCharacter(e);if(null==e.selectedCharacter||null==e.selectedCharacterState)throw new Error("Expected a selected character and state");var t=e.selectedCharacter;this.characterIndexToPriority.has(t.index)||this.assignPriority(t.index,e);e.selectedCharacterState;if(t.tileCoords.equals(e.getEnemyFlag().tileCoords)&&!t.hasMoved)return this.getActionsForFlagCarrrier(t,e);if(!t.hasMoved&&!t.hasShot)return this.getHasntMovedNorShot(t,e);if(!t.hasShot){var n=yt(t.tileCoords),a=this.getEnemyTargetsInDirectSight(n,e);if(a.length>0)return this.getShootSequence(this.getBestShot(t.tileCoords,e,a))}if(this.settings.heals&&t.health<t.settings.maxHealth&&null!=t.extraAbilities.find((function(e){return e.abilityType===de.HEAL}))){return[function(e){return{type:ue.HEAL,healAmount:t.extraAbilities.find((function(e){return e.abilityType===de.HEAL})).healAmount}}]}return[function(e){return{type:ue.END_CHARACTER_TURN}}]},e.prototype.placeCharacter=function(e){var t=this,n=e.getActiveSquad().length;this.assignPriority(n,e);var a=this.characterIndexToPriority.get(n);return[function(e){return{type:ue.SELECT_CHARACTER_CLASS,class:t.settings.characterClass}},function(e){e.selectableTiles[0];var n=[];if((n=a===at.DEFEND?t.getClosestSelectableTileToLocationWithFewestDirectHits(e.getActiveTeamFlag().tileCoords,e):t.getClosestSelectableTileToLocationWithFewestDirectHits(e.getEnemyFlag().tileCoords,e)).length>0){var r=n[0];return t.settings.randomizeMovement&&(r=nt(n)),{type:ue.SELECT_TILE,tile:r}}return t.log("AI: No optimal tiles in placement"),{type:ue.SELECT_TILE,tile:e.selectableTiles[0]}}]},e.prototype.getHasntMovedNorShot=function(e,t){var n,a,r=this,o=yt(e.tileCoords),s=this.characterIndexToPriority.get(e.index),l=this.getEnemyTargetsInDirectSight(o,t);if(l.length>0){var c=this.getShootSequence(this.getBestShot(e.tileCoords,t,l)),y=null;if(s===at.DEFEND)y=t.getActiveTeamFlag().tileCoords;else if(s===at.ELIMINATE){var h=this.getVisibleEnemies(t);if(h.length>0){var u=[];try{for(var x=i(h),d=x.next();!d.done;d=x.next()){var f=d.value,g={dist:f.tileCoords.manhattanDistanceTo(e.tileCoords),tile:f.tileCoords,hp:f.health};0===u.length?u.push(g):g.hp<u[0].hp||g.hp===u[0].hp&&g.dist<u[0].dist?u=[g]:g.hp===u[0].hp&&g.dist===u[0].dist&&u.push(g)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(a=x.return)&&a.call(x)}finally{if(n)throw n.error}}y=u[0].tile,this.settings.randomizeMovement&&(y=nt(u).tile)}else y=t.enemyHasFlag()?t.getActiveTeamFlag().tileCoords:t.getEnemyFlag().tileCoords}else y=t.enemyHasFlag()?t.getActiveTeamFlag().tileCoords:t.getEnemyFlag().tileCoords;var m=this.getSafeMoveTowardsLocation(e,y);return c.concat(m)}return[function(e){return{type:ue.SELECT_CHARACTER_STATE,state:Qe.MOVING}},function(t){var n,a,o,l,c,y,h=t.selectedCharacter,u=h.health===h.settings.maxHealth;if(0===t.selectableTiles.length)return r.log("AI: No selectable tiles when able to move"),{type:ue.END_CHARACTER_TURN};var x=[];try{for(var d=i(t.selectableTiles),f=d.next();!f.done;f=d.next()){var g=f.value,m=yt(g),p=r.getEnemyTargetsInDirectSight(m,t);x.push({tile:g,directHits:p.length})}}catch(e){n={error:e}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}var T=[],v=r.getVisibleEnemies(t),S=x.filter((function(e){return 1===e.directHits||2===e.directHits&&u}));if(S.length>0)T=S.map((function(e){return e.tile}));else{var C=null;if(s===at.DEFEND)if(t.getActiveTeamFlag().isAtStart()){var E=v.filter((function(e){return e.tileCoords.manhattanDistanceTo(h.tileCoords)<=h.settings.maxSight}));if(0===v.length||0===E.length){T=t.selectableTiles.filter((function(e){return e.manhattanDistanceTo(t.getActiveTeamFlag().tileCoords)<5}))}else{var A=[];try{for(var I=i(E),w=I.next();!w.done;w=I.next()){var L={hp:(R=w.value).health,tile:R.tileCoords};0===A.length?A.push(L):R.health<A[0].hp?A=[L]:R.health===A[0].hp&&A.push(L)}}catch(e){o={error:e}}finally{try{w&&!w.done&&(l=I.return)&&l.call(I)}finally{if(o)throw o.error}}C=A[0].tile,r.settings.randomizeMovement&&(C=nt(A).tile)}}else C=t.getActiveTeamFlag().tileCoords;else if(s===at.ELIMINATE)if(v.length>0){A=[];try{for(var b=i(v),M=b.next();!M.done;M=b.next()){var R;L={dist:(R=M.value).tileCoords.manhattanDistanceTo(e.tileCoords),tile:R.tileCoords,hp:R.health};0===A.length?A.push(L):L.hp<A[0].hp||L.hp===A[0].hp&&L.dist<A[0].dist?A=[L]:L.hp===A[0].hp&&L.dist===A[0].dist&&A.push(L)}}catch(e){c={error:e}}finally{try{M&&!M.done&&(y=b.return)&&y.call(b)}finally{if(c)throw c.error}}var _=A.map((function(e){return e.tile}));C=_[0],r.settings.randomizeMovement&&(C=nt(_))}else C=t.enemyHasFlag()?t.getActiveTeamFlag().tileCoords:t.getEnemyFlag().tileCoords;else C=t.enemyHasFlag()?t.getActiveTeamFlag().tileCoords:t.getEnemyFlag().tileCoords;null!=C&&(T=r.getClosestSelectableTileToLocationWithFewestDirectHits(C,t))}var P=T[0];return r.settings.randomizeMovement&&(P=nt(T)),null==P?{type:ue.END_CHARACTER_TURN}:{type:ue.SELECT_TILE,tile:P}}]},e.prototype.getActionsForFlagCarrrier=function(e,t){var n=t.getActiveTeamFlag().tileCoords;return this.getSafeMoveTowardsLocation(e,n)},e.prototype.getSafeMoveTowardsLocation=function(e,t){var n=this;return[function(e){return{type:ue.SELECT_CHARACTER_STATE,state:Qe.MOVING}},function(e){var a=n.getClosestSelectableTileToLocationWithFewestDirectHits(t,e),r=a[0];return n.settings.randomizeMovement&&(r=nt(a)),null==r?{type:ue.END_CHARACTER_TURN}:{type:ue.SELECT_TILE,tile:r}}]},e.prototype.getClosestSelectableTileToLocationWithFewestDirectHits=function(e,t){var n,a,r={tile:t.selectableTiles[0],distance:1e4,directHits:100},o=[];try{for(var s=i(t.selectableTiles),l=s.next();!l.done;l=s.next()){var c=l.value,y=ht(c,e,t),h=yt(c),u=this.getEnemyTargetsInDirectSight(h,t).length;u<r.directHits||u===r.directHits&&y.length<r.distance?(r.tile=c,r.distance=y.length,r.directHits=u,o=[r.tile]):u===r.directHits&&y.length===r.distance&&o.push(c)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return o},e.prototype.getBestShot=function(e,t,n){var a,r,o,s;try{for(var l=i(n),c=l.next();!c.done;c=l.next()){if((f=c.value).target.tile.equals(t.getActiveTeamFlag().tileCoords))return f}}catch(e){a={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(a)throw a.error}}var y=t.getEnemyCharacters(),h=null,u=function(t){var n=y.find((function(e){return e.tileCoords.equals(t.target.tile)}));if(null==n)throw new Error("Expected a character at shot: "+JSON.stringify(t));var a=n.health,r=n.tileCoords.manhattanDistanceTo(e);(null==h||a<h.targetHealth||a===h.targetHealth&&r<h.distance)&&(h={shot:t,distance:r,targetHealth:a})};try{for(var x=i(n),d=x.next();!d.done;d=x.next()){var f;u(f=d.value)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(s=x.return)&&s.call(x)}finally{if(o)throw o.error}}if(null==h)throw new Error("Expected to find best shot in getBestShot");return h.shot},e.prototype.getShootSequence=function(e){var t=this;return[function(e){return{type:ue.SELECT_CHARACTER_STATE,state:Qe.AIMING}},function(n){var a=Math.random()*t.settings.maxAngleRandomization*-t.settings.maxAngleRandomization/2,r=e.aimAngleClockwiseRadians+a;return{type:ue.AIM,aimAngleClockwiseRadians:r}},function(e){return{type:ue.SHOOT}}]},e.prototype.getEnemyTargetsInDirectSight=function(e,t){var n,a,r,o,s=E.getTileFromCanvasCoords(e),l=[],c=this.getVisibleEnemies(t);try{for(var h=i(c),u=h.next();!u.done;u=h.next()){var x=u.value,d=yt(x.tileCoords).subtract(e).normalize().getPointRotationRadians(),f=Ve({ray:(r=e,o=d,new oe(r,new y(Math.cos(o),Math.sin(o)))),characters:t.getAliveCharacters(),obstacles:t.obstacles,fromTeamIndex:this.teamIndex,startTile:s});f.tile.equals(x.tileCoords)&&l.push({aimAngleClockwiseRadians:d,target:f})}}catch(e){n={error:e}}finally{try{u&&!u.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}return l},e.prototype.getVisibleEnemies=function(e){var t=this;return e.getEnemyCharacters().filter((function(n){return!!t.settings.ignoresFogOfWar||e.isTileVisibleByTeamIndex(n.tileCoords,t.teamIndex)}))},e.prototype.assignPriority=function(e,t){var n=this.getNextPriority(t);this.log("AI: Assigning priority: "+n),this.characterIndexToPriority.set(e,n)},e.prototype.getNextPriority=function(e){var t=this,n=e.settings.teamIndexToSquadSize.get(this.teamIndex),a=1/4*n,r=.5*n;return e.getActiveSquad().filter((function(e){var n=t.characterIndexToPriority.get(e.index);return null!=n&&n===at.DEFEND})).length<a?at.DEFEND:e.getActiveSquad().filter((function(e){var n=t.characterIndexToPriority.get(e.index);return null!=n&&n===at.SNAG})).length<r?at.SNAG:at.ELIMINATE},e.prototype.log=function(e){rt.log(et.AI,e)},e}();function yt(e){return E.getCanvasFromTileCoords(e).add(E.HALF_TILE)}function ht(e,t,n){return n.getPath({from:e,to:t})}var ut=function(){function e(e){this.tileCoords=e.tileCoords,this.teamIndex=e.teamIndex,this.turnsBetweenSpawns=e.turnsBetweenSpawns,this.turnsSinceLastSpawn=0}return e.prototype.update=function(e){},e.prototype.advanceTurn=function(){this.turnsSinceLastSpawn+=1},e.prototype.checkAndHandleRespawn=function(){return this.turnsSinceLastSpawn===this.turnsBetweenSpawns&&(this.turnsSinceLastSpawn=0,!0)},e.prototype.render=function(e){e.strokeStyle=0===this.teamIndex?H:N;for(var t=E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE),n=Math.PI/16,a=Math.PI/32,r=0,i=2*Math.PI-n,o=.4*E.TILE_SIZE;r<i;)e.beginPath(),e.arc(t.x,t.y,o,r,r+n),e.stroke(),r+=n+a;var s=""+(this.turnsBetweenSpawns-this.turnsSinceLastSpawn);e.fillStyle=M;new y(E.TILE_SIZE/12,E.TILE_SIZE/12);e.font="12px fantasy",e.fillText(s,t.x-3,t.y+1)},e}(),xt=function(){function e(e){this.context=e,this.elements=[]}return e.prototype.addElement=function(e){this.elements.push(e)},e.prototype.removeAll=function(){this.elements=[]},e.prototype.removeElement=function(e){this.elements.splice(this.elements.indexOf(e),1)},e.prototype.onMouseMove=function(e){var t,n,a=this.getUiCoords(e);try{for(var r=i(this.elements),o=r.next();!o.done;o=r.next()){o.value.onMouseMove(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.onClick=function(e){var t,n,a=this.getUiCoords(e);try{for(var r=i(this.elements),o=r.next();!o.done;o=r.next()){if(o.value.onClick(a))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!1},e.prototype.render=function(){var e,t;try{for(var n=i(this.elements),a=n.next();!a.done;a=n.next()){a.value.render(this.context)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.getUiCoords=function(e){return new y(e.x/a.canvasWidth,e.y/a.canvasHeight)},e}(),dt=function(){function e(e){var t=this,n=e.dimensions,a=e.style;this.render=function(e){var n=t.getCanvasCoords(t.topLeft),a=t.getCanvasCoords(t.size);e.fillStyle=t.color,e.fillRect(n.x,n.y,a.x,a.y),e.fillStyle=t.textColor;var r=t.fontSize;e.font=r+"px fantasy";var i=e.measureText(t.text).width,o=t.getCanvasCoords(t.getBoxCenter());e.fillText(t.text,o.x-i/2,o.y+r/4)},this.onClick=function(e){return!1},this.onMouseMove=function(e){},this.topLeft=n.topLeft,this.size=n.size,this.text=n.text,this.fontSize=a.fontSize,this.color=a.color,this.textColor=a.textColor}return e.prototype.getBoxCenter=function(){return new y(this.topLeft.x+this.size.x/2,this.topLeft.y+this.size.y/2)},e.prototype.getCanvasCoords=function(e){return new y(e.x*a.canvasWidth,e.y*a.canvasHeight)},e}(),ft=function(){function e(e){var t=this,n=e.dimensions,a=e.style,r=e.onClick;this.render=function(e){var n=t.getCanvasCoords(t.topLeft),a=t.getCanvasCoords(t.size);e.fillStyle=t.getFillColor(),e.fillRect(n.x,n.y,a.x,a.y),e.fillStyle=t.textColor;var r=t.fontSize;e.font=r+"px fantasy";var i=e.measureText(t.text).width,o=t.getCanvasCoords(t.getButtonCenter());if(e.fillText(t.text,o.x-i/2,o.y+r/4),t.isSelected){if(null==t.selectedBorderColor)throw new Error("Selected border color should be set when button is selected");e.strokeStyle=t.selectedBorderColor,e.strokeRect(n.x,n.y,a.x,a.y)}},this.onClick=function(e){return!!t.isInButton(e)&&(t.onClickCallback(),!0)},this.onMouseMove=function(e){t.isHovered=t.isInButton(e)},this.topLeft=n.topLeft,this.size=n.size,this.text=n.text,this.fontSize=a.fontSize,this.color=a.color,this.textColor=a.textColor,this.hoverColor=a.hoverColor,this.selectedColor=a.selectedColor,this.selectedBorderColor=a.selectedBorderColor,this.onClickCallback=r,this.isHovered=!1,this.isSelected=!1}return e.prototype.getFillColor=function(){return this.isSelected?this.selectedColor:this.isHovered?this.hoverColor:this.color},e.prototype.setIsSelected=function(e){this.isSelected=e},e.prototype.isInButton=function(e){var t=e.x>=this.topLeft.x&&e.x<=this.topLeft.x+this.size.x,n=e.y>=this.topLeft.y&&e.y<=this.topLeft.y+this.size.y;return t&&n},e.prototype.getButtonCenter=function(){return new y(this.topLeft.x+this.size.x/2,this.topLeft.y+this.size.y/2)},e.prototype.getCanvasCoords=function(e){return new y(e.x*a.canvasWidth,e.y*a.canvasHeight)},e}(),gt=function(){function e(e){var t=this;this.render=function(e){var n,a;try{for(var r=i(t.buttons),o=r.next();!o.done;o=r.next()){o.value.render(e)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}},this.onClick=function(e){var n,a;try{for(var r=i(t.buttons),o=r.next();!o.done;o=r.next()){if(o.value.onClick(e))return!0}}catch(e){n={error:e}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}return!1},this.onMouseMove=function(e){var n,a;try{for(var r=i(t.buttons),o=r.next();!o.done;o=r.next()){o.value.onMouseMove(e)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}},this.onButtonClicked=function(e){e!==t.currentlySelectedIndex&&(t.buttons[t.currentlySelectedIndex].setIsSelected(!1),t.currentlySelectedIndex=e,t.buttons[t.currentlySelectedIndex].setIsSelected(!0),t.onChangeCallback(t.currentlySelectedIndex))},this.buttons=[];for(var n=function(n){var r=e.buttons[n];a.buttons.push(new ft({dimensions:{topLeft:r.topLeft,size:r.size,text:r.text},style:{fontSize:e.buttonStyle.fontSize,color:e.buttonStyle.color,hoverColor:e.buttonStyle.hoverColor,textColor:e.buttonStyle.textColor,selectedColor:e.buttonStyle.selectedColor,selectedBorderColor:e.buttonStyle.selectedBorderColor},onClick:function(){t.onButtonClicked(n)}}))},a=this,r=0;r<e.buttons.length;r++)n(r);this.onChangeCallback=e.onChangeCallback,this.currentlySelectedIndex=e.initialSelectionIndex,this.buttons[this.currentlySelectedIndex].setIsSelected(!0)}return e.prototype.select=function(e){var t,n;try{for(var a=i(this.buttons),r=a.next();!r.done;r=a.next()){r.value.setIsSelected(!1)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this.buttons[e].setIsSelected(!0)},e}(),mt=function(){function e(e){this.context=e,this.borderWidth=8,this.leftEdgeCanvas=E.GAME_WIDTH,this.leftUiCoord=(E.GAME_WIDTH+this.borderWidth)/a.canvasWidth,this.widthUi=1-this.leftUiCoord,this.horizontalMargins=.01,this.maxWidth=this.widthUi-2*this.horizontalMargins,this.leftMargin=this.leftUiCoord+this.horizontalMargins,this.maxWidthUi=1-this.leftMargin-this.horizontalMargins,this.fontSize=18,this.descriptionFontSize=16,this.buttonOffsetY=.01,this.buttonSize=new y(this.maxWidth,.05),this.headerSize=new y(this.maxWidth,.025),this.headerStyle={color:V,fontSize:this.fontSize,textColor:ee},this.buttonStyle={fontSize:this.fontSize,color:Y,hoverColor:Q,selectedColor:X,selectedBorderColor:J,textColor:$},this.uiManager=new xt(e)}return e.prototype.update=function(e){},e.prototype.mouseMove=function(e){this.uiManager.onMouseMove(e)},e.prototype.tryClick=function(e){return this.uiManager.onClick(e)},e.prototype.render=function(e){e.fillStyle=V,e.fillRect(this.leftEdgeCanvas,0,E.BUTTON_PANE_WIDTH,E.BUTTON_PANE_HEIGHT),e.fillStyle="#000000",e.fillRect(this.leftEdgeCanvas,0,this.borderWidth,E.BUTTON_PANE_HEIGHT),this.uiManager.render()},e.prototype.selectIndex=function(e){if(void 0===this.buttonGroup)throw new Error("No buttonGroup in selectIndex'");this.buttonGroup.select(e)},e.prototype.clear=function(){this.buttonGroup=void 0,this.clearBottomButtons(),this.clearDescription(),this.uiManager.removeAll()},e.prototype.configurePanel=function(e){for(var t=e.headerTextLines,n=e.buttonInfos,a=e.isButtonGroup,r=t.length,i=.02,o=0;o<r;o++){var s=new dt({dimensions:{size:this.headerSize,text:t[o],topLeft:new y(this.leftMargin,i)},style:this.headerStyle});this.uiManager.addElement(s),i+=this.buttonOffsetY+this.headerSize.y}for(var l=[],c=0;c<n.length;c++){var h=i+(o=c%6)*this.buttonOffsetY+o*this.buttonSize.y,u=n[c];l.push({topLeft:new y(this.leftMargin,h),size:this.buttonSize,text:u.name+" ("+p.getStringForKey(u.key)+")"})}if(a)this.buttonGroup=new gt({buttons:l,buttonStyle:this.buttonStyle,initialSelectionIndex:0,onChangeCallback:function(e){n[e].func()}}),this.uiManager.addElement(this.buttonGroup);else for(var x=0;x<n.length;x++){var d=l[x];this.uiManager.addElement(new ft({dimensions:d,style:this.buttonStyle,onClick:n[x].func}))}var f=l[l.length-1];this.buttonGroupBottomMargin=f.topLeft.y+f.size.y},e.prototype.setDescription=function(e){var t=this.buttonGroupBottomMargin+2*this.buttonOffsetY;this.clearDescription();for(var n={fontSize:this.descriptionFontSize,color:this.headerStyle.color,textColor:this.headerStyle.textColor},r=0;r<e.length;r++){var i=e[r];this.context.font=this.descriptionFontSize+"px fantasy";var o=this.context.measureText(i).width/a.canvasWidth,s=new y(o,this.headerSize.y),l=new dt({dimensions:{size:s,text:i,topLeft:new y(this.leftMargin,t)},style:n});this.descriptionTextBoxes.push(l),this.uiManager.addElement(l),t+=this.headerSize.y-.002}},e.prototype.clearDescription=function(){var e,t;if(null!=this.descriptionTextBoxes){try{for(var n=i(this.descriptionTextBoxes),a=n.next();!a.done;a=n.next()){var r=a.value;this.uiManager.removeElement(r)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.descriptionTextBoxes=[]}else this.descriptionTextBoxes=[]},e.prototype.setBottomButtons=function(e){var t,n;this.clearBottomButtons();var a=1+(-this.buttonOffsetY-this.buttonSize.y)*e.length;try{for(var r=i(e),o=r.next();!o.done;o=r.next()){var s=o.value,l={topLeft:new y(this.leftMargin,a),size:this.buttonSize,text:s.name+" ("+p.getStringForKey(s.key)+")"},c=new ft({dimensions:l,style:this.buttonStyle,onClick:s.func});this.uiManager.addElement(c),this.bottomButtons.push(c),a+=this.buttonOffsetY+this.buttonSize.y}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.clearBottomButtons=function(){var e,t;if(null!=this.bottomButtons&&this.bottomButtons.length>0)try{for(var n=i(this.bottomButtons),a=n.next();!a.done;a=n.next()){var r=a.value;this.uiManager.removeElement(r)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.bottomButtons=[]},e}(),pt=x.P,Tt=x.Q,vt=x.R,St=x.M,Ct=x.A,Et=x.S,At=x.D,It=x.SHIFT,wt=x.F,Lt=x.H,bt=x.T,Mt=x.E,Rt=new Map([[x.J,fe.SCOUT],[x.K,fe.ASSAULT],[x.L,fe.SNIPER],[x.I,fe.DEMOLITION]]),_t=function(){function e(e,t){this.context=e,this.delegate=t,this.gameClickHandler=null,this.controlMap=new d,this.buttonPanel=new mt(this.context)}return e.prototype.clear=function(){this.controlMap.clear(),this.buttonPanel.clear(),this.gameClickHandler=null},e.prototype.render=function(){this.buttonPanel.render(this.context)},e.prototype.update=function(e){if(this.controlMap.check(),this.buttonPanel.mouseMove(p.getMouseCanvasCoords()),p.hasClick()){var t=p.handleClick();if(!this.buttonPanel.tryClick(t)){var n=E.getTileFromCanvasCoords(t);null!=this.gameClickHandler&&this.gameClickHandler.onClick(n)}}},e.prototype.initDefaultControls=function(){this.clear(),this.addDefaultControls()},e.prototype.initForCharacterPlacement=function(){var e=this;this.clear(),this.gameClickHandler={onClick:function(t){e.tryPlacingCharacter(t)}},this.addDefaultControls(),this.addCharacterClassControls()},e.prototype.initGameOverControls=function(){this.clear(),this.addQuitAndRestartControls(!0);var e=p.getStringForKey(Tt),t=p.getStringForKey(vt);this.delegate.setToastText("Press "+e+" to quit, "+t+" to restart")},e.prototype.initForSelectedCharacterState=function(){var e,t,n,a,r=this;this.clear();var o=this.delegate,c=o.getGameState();if(null==c.selectedCharacter||null==c.selectedCharacterState)throw new Error("There needs to be a selected character before calling setSelectedCharacterState");this.buttonPanel.clear(),this.controlMap.clear(),this.gameClickHandler=null,this.addDefaultControls(),this.addSwitchSquadMemberControls();var y,h,u=Math.PI/64,x=[],d=[];switch(c.selectedCharacterState){case Qe.AWAITING:d=["Available actions"],c.selectedCharacter.hasMoved||x.push({key:St,name:"Move",func:function(){var e={type:ue.SELECT_CHARACTER_STATE,state:Qe.MOVING};o.onAction(e)},eventType:l.KeyPress}),c.selectedCharacter.canShoot()&&x.push({key:Ct,name:"Aim",func:function(){var e={type:ue.SELECT_CHARACTER_STATE,state:Qe.AIMING};o.onAction(e)},eventType:l.KeyPress});var f=function(e){switch(e.abilityType){case de.HEAL:x.push({key:Lt,name:"Heal",func:function(){var t={type:ue.HEAL,healAmount:e.healAmount};o.onAction(t)},eventType:l.KeyPress});break;case de.THROW_GRENADE:x.push({key:bt,name:"Throw grenade",func:function(){var e={type:ue.SELECT_CHARACTER_STATE,state:Qe.THROWING_GRENADE};o.onAction(e)},eventType:l.KeyPress})}};try{for(var g=i(c.selectedCharacter.extraAbilities),m=g.next();!m.done;m=g.next()){f(m.value)}}catch(t){e={error:t}}finally{try{m&&!m.done&&(t=g.return)&&t.call(g)}finally{if(e)throw e.error}}break;case Qe.MOVING:d=["Select a destination"],this.gameClickHandler={onClick:function(e){r.tryMovingSelectedCharacter(e)}},x.push({key:St,name:"Cancel Move",func:function(){var e={type:ue.SELECT_CHARACTER_STATE,state:Qe.AWAITING};o.onAction(e)},eventType:l.KeyPress});break;case Qe.AIMING:d=["Adjust aim and fire"],x.push({key:Ct,name:"Stop Aiming",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when canceling shooting.");var e={type:ue.SELECT_CHARACTER_STATE,state:Qe.AWAITING};o.onAction(e)},eventType:l.KeyPress}),x.push({key:Et,name:"Aim CCW",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when aiming CCW.");var e=-u;p.isKeyDown(It)&&(e+=u/2);var t=c.selectedCharacter.getAim()+e,n={type:ue.AIM,aimAngleClockwiseRadians:t};o.onAction(n)},eventType:l.KeyDown}),x.push({key:At,name:"Aim CC",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when aiming CC.");var e=u;p.isKeyDown(It)&&(e-=u/2);var t=c.selectedCharacter.getAim()+e,n={type:ue.AIM,aimAngleClockwiseRadians:t};o.onAction(n)},eventType:l.KeyDown}),x.push({key:wt,name:"Fire",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when canceling shooting.");var e={type:ue.SHOOT};o.onAction(e)},eventType:l.KeyPress});break;case Qe.THROWING_GRENADE:d=["Select grenade target"],this.gameClickHandler={onClick:function(e){r.tryThrowingGrenade(e)}},x.push({key:bt,name:"Cancel",func:function(){var e={type:ue.SELECT_CHARACTER_STATE,state:Qe.AWAITING};o.onAction(e)},eventType:l.KeyPress});break;default:throw new Error("Unknown selected character state")}x.push({key:Mt,name:"End character turn",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when ending turn.");var e={type:ue.END_CHARACTER_TURN};o.onAction(e)},eventType:l.KeyPress}),this.buttonPanel.configurePanel({headerTextLines:d,buttonInfos:x,isButtonGroup:!1}),this.buttonPanel.setDescription((y=c.selectedCharacter,h=[],Pt(y.settings.type),h.push.apply(h,s(["HP: "+Math.round(y.health)+" / "+y.settings.maxHealth,"Moves: "+y.settings.maxMovesPerTurn,"Sight: "+y.settings.maxSight,"","Gun:"],Ft(y.settings.gun).map((function(e){return"  "+e})),["","Abilities:"],function(e){var t,n,a=[],r=e.characterAbilityTypeToAbilityState,o=function(t){var n=r.get(t);if(null==n.usesLeft||n.usesLeft<=0)return"continue";a.push("");for(var i=kt(s(e.settings.extraActions).find((function(e){return e.abilityType===t}))),o=0;o<i.length;o++){var l=i[o];l.indexOf("Max uses")>0?i[o]="  Uses left: "+n.usesLeft:l.indexOf("Cooldown turns")>0&&(n.cooldownTurnsLeft>0?i[o]="  Cooling down ("+n.cooldownTurnsLeft+" turns til ready)":i[o]="  Ready to use")}a.push.apply(a,s(i))};try{for(var l=i(r.keys()),c=l.next();!c.done;c=l.next()){var y=c.value;o(y)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return a}(y).map((function(e){return"  "+e})))),h));try{for(var T=i(x),v=T.next();!v.done;v=T.next()){var S=v.value;this.controlMap.add(S)}}catch(e){n={error:e}}finally{try{v&&!v.done&&(a=T.return)&&a.call(T)}finally{if(n)throw n.error}}},e.prototype.tryPlacingCharacter=function(e){if(this.delegate.getGameState().selectableTiles.find((function(t){return t.equals(e)}))){var t={type:ue.SELECT_TILE,tile:e};this.delegate.onAction(t)}else this.delegate.setToastText("Can't place character here")},e.prototype.trySelectingCharacter=function(e){var t=this.delegate.getGameState().getActiveSquad().find((function(t){return t.tileCoords.equals(e)}));if(t&&!t.isTurnOver()){var n={type:ue.SELECT_CHARACTER,characterIndex:t.index};this.delegate.onAction(n)}},e.prototype.tryMovingSelectedCharacter=function(e){if(this.delegate.getGameState().selectableTiles.find((function(t){return t.equals(e)}))){var t={type:ue.SELECT_TILE,tile:e};this.delegate.onAction(t)}else this.delegate.setToastText("Can't move character here")},e.prototype.tryThrowingGrenade=function(e){if(this.delegate.getGameState().selectableTiles.find((function(t){return t.equals(e)}))){var t={type:ue.SELECT_TILE,tile:e};this.delegate.onAction(t)}else this.delegate.setToastText("Can't throw grenade here")},e.prototype.addSwitchSquadMemberControls=function(){var e,t,n=this,a=this.delegate.getGameState().getActiveSquad();this.gameClickHandler={onClick:function(e){n.trySelectingCharacter(e)}};var r=function(e){if(e.index>=9)return"continue";var t=e.index+1,a=g.get(t);if(null==a)throw new Error("Not enough keys for all character numbers!");o.controlMap.add({key:a,name:"Select "+m.get(t)+" character",func:function(){var t={type:ue.SELECT_CHARACTER,characterIndex:e.index};n.delegate.onAction(t)},eventType:l.KeyPress})},o=this;try{for(var s=i(a),c=s.next();!c.done;c=s.next()){r(c.value)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}},e.prototype.addDefaultControls=function(){var e=this,t={key:pt,name:"Pause",func:function(){e.togglePause()},eventType:l.KeyPress};this.controlMap.add(t),this.buttonPanel.setBottomButtons([t])},e.prototype.addQuitAndRestartControls=function(e){var t,n,a=this;void 0===e&&(e=!1);var r=[];e||r.push({key:pt,name:"Resume",func:function(){a.togglePause(),a.controlMap.remove(pt),a.addDefaultControls()},eventType:l.KeyPress}),r.push({key:vt,name:"Restart",func:this.delegate.onRestart,eventType:l.KeyPress},{key:Tt,name:"Quit",func:this.delegate.onQuit,eventType:l.KeyPress});try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var c=s.value;this.controlMap.add(c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this.buttonPanel.setBottomButtons(r)},e.prototype.addCharacterClassControls=function(){var e,t,n=this,a=[],r=function(e){var t=Rt.get(e),r={key:e,name:t,func:function(){var e={type:ue.SELECT_CHARACTER_CLASS,class:Pt(t)};n.delegate.onAction(e);var a=s(Rt.values()).findIndex((function(e){return t===e}));n.buttonPanel.selectIndex(a);var r=Dt(t);n.buttonPanel.setDescription(r)},eventType:l.KeyPress};a.push(r),o.controlMap.add(r)},o=this;try{for(var c=i(Rt.keys()),y=c.next();!y.done;y=c.next()){r(y.value)}}catch(t){e={error:t}}finally{try{y&&!y.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}this.buttonPanel.configurePanel({headerTextLines:["Select Character","Class to Place"],buttonInfos:a,isButtonGroup:!0}),this.buttonPanel.setDescription(Dt(be[0].type))},e.prototype.togglePause=function(){var e=!this.delegate.isPaused();this.delegate.onTogglePause(),e?(this.controlMap.remove(pt),this.addQuitAndRestartControls()):(this.controlMap.remove(Tt),this.controlMap.remove(vt))},e}();function Pt(e){return be.find((function(t){return t.type===e}))}function Dt(e){var t=Pt(e);return s(["HP: "+t.maxHealth,"Moves: "+t.maxMovesPerTurn,"Sight: "+t.maxSight,"","Gun:"],Ft(t.gun).map((function(e){return"  "+e})),["","Abilities:"],function(e){var t,n,a=[];try{for(var r=i(e),o=r.next();!o.done;o=r.next()){var l=o.value;a.push(""),a.push.apply(a,s(kt(l)))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return a}(s(t.extraActions)).map((function(e){return"  "+e})))}function Ft(e){var t=[];if(e.projectileDetails.type===ye.BULLET){var n=e.spray?"(x"+e.spray.projectiles+")":"";t=["Projectile type: bullet","Damage: "+e.projectileDetails.damage+n,"Max ricochets: "+e.projectileDetails.numRicochets]}else t=["Projectile type: explosive","Damage: "+e.projectileDetails.damage,"Damage radius: "+e.projectileDetails.damageManhattanDistanceRadius,"Max ricochets: "+e.projectileDetails.numRicochets];var a=s(t);return e.canFireAfterMoving||a.push("Can't shoot after moving"),a}function kt(e){var t=[];return e.abilityType===de.HEAL?t.push("Heal","  Heal amount: "+e.healAmount):t.push("Grenade","  Damage: "+e.splashDamage.damage,"  Damage radius: "+e.splashDamage.damageManhattanDistanceRadius,"  Range: "+e.maxManhattanDistance),t.push("  Max uses: "+e.maxUses),e.maxUses>1&&t.push("  Cooldown turns: "+e.cooldownTurns),e.isFree?t.push("  Can also shoot"):t.push("  Can't use and shoot"),t}var Ot,Nt=n.p+"7252df4f170f3c3fcf46805b0396a23c.jpg",Ht=function(){function e(e,t,n){var a=this;this.blackWoodTexture=new Ze(Nt),this.onAnimationDone=null,this.gameDelegate={getCurrentAimPath:function(e){var t=a.gameState.getAliveCharacters();return a.gameState.settings.hasFogOfWar&&t.filter((function(e){return a.gameState.isTileVisibleByTeamIndex(e.tileCoords,a.gameState.currentTeamIndex)})),Ke(r(r({},e),{characters:t,obstacles:a.gameState.obstacles}))}},this.onProjectileAnimationOver=function(){a.checkGameOver(),a.isGameOver||a.checkCharacterTurnOver()},this.resetGame=function(){a.destroy(),a.gameState=new tt(a.gameSettings),a.loadLevel(),a.isGameOver=!1,a.isPaused=!1,a.onAnimationDone=null,a.winningTeamIndex=-1,a.gameState.gamePhase=Ye.CHARACTER_PLACEMENT,a.selectedCharacterSettings=be[0],a.gameState.characters=[],a.projectiles=[],a.particleSystems=[],a.ais=[],a.teamIndexToIsAi=[];for(var e=a.gameSettings.matchType,t=0;t<a.gameSettings.numTeams;t++){var n=0!==t;e===I.AI_VS_AI?n=!0:e===I.PLAYER_VS_PLAYER_LOCAL&&(n=!1),a.teamIndexToIsAi.push(n),n&&a.ais.push(new ct({teamIndex:t,difficulty:a.gameState.settings.aiDifficulty}))}a.hud=new Ue(a.context),a.inputManager=new _t(a.context,{isPaused:function(){return a.isPaused},getGameState:function(){return a.getGameState()},onAction:function(e){a.onAction(e)},onRestart:function(){a.resetGame()},onQuit:function(){a.onExitGameCallback(a.winningTeamIndex)},onTogglePause:function(){a.togglePause()},setToastText:function(e){a.hud.setText(e,Ne.TOAST,Oe.SHORT)}}),a.gameState.currentTeamIndex=-1,a.nextTurn()},this.canvas=e,this.context=t,this.gameSettings=n.gameSettings,this.levelIndex=n.levelIndex,this.onExitGameCallback=n.onExitGameCallback,this.resetGame()}return e.prototype.isAnimating=function(){return s(this.gameState.getAliveCharacters(),this.projectiles).some((function(e){return e.animationState.isAnimating}))},e.prototype.update=function(e){var t,n,a,r,o,s;if(this.inputManager.update(e),!this.isPaused){try{for(var l=i(this.particleSystems),c=l.next();!c.done;c=l.next()){c.value.update(e)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}this.particleSystems=this.particleSystems.filter((function(e){return e.isAlive}));try{for(var y=i(this.projectiles),h=y.next();!h.done;h=y.next()){var u=h.value;this.updateProjectile(e,u)}}catch(e){a={error:e}}finally{try{h&&!h.done&&(r=y.return)&&r.call(y)}finally{if(a)throw a.error}}this.projectiles=this.projectiles.filter((function(e){return!e.isDead||!e.isTrailGone()}));try{for(var x=i(this.gameState.getAliveCharacters()),d=x.next();!d.done;d=x.next()){var f=d.value;f.update(e),f.animationState.isAnimating&&this.shouldSkipAnimation(f)&&f.skipAnimation()}}catch(e){o={error:e}}finally{try{d&&!d.done&&(s=x.return)&&s.call(x)}finally{if(o)throw o.error}}if(this.hud.update(e),this.isAnimating()||null==this.onAnimationDone||(this.onAnimationDone(),this.onAnimationDone=null),(this.gameState.gamePhase===Ye.CHARACTER_PLACEMENT||0!==this.gameState.getActiveSquad().filter((function(e){return!e.isTurnOver()})).length)&&this.isAiTurn()&&!this.isAnimating()){var g=this.getCurrentTurnAi().getNextAction(this.getGameState());this.onAction(g)}}},e.prototype.updateProjectile=function(e,t){var n,a,r,o;if(t.update(e),!t.isDead&&t.isAtFinalTarget()){var s=t.getCurrentTarget(),l=s.canvasCoords;if(t.projectileDetails.type===ye.SPLASH){var c=t.projectileDetails;this.particleSystems.push(new Ge({startPositionCanvas:l,particleCount:160,colorA:"#a1a1a1",colorB:"#403f3f",shape:ge.CIRCLE,minParticleSpeed:5e-4*E.TILE_SIZE,maxParticleSpeed:.001*E.TILE_SIZE,minLifetimeMs:800,maxLifetimeMs:100,minRadius:.055*E.TILE_SIZE,maxRadius:.085*E.TILE_SIZE})),this.particleSystems.push(new Ge(function(e){return{startPositionCanvas:e,particleCount:100,colorA:"#e3a14f",colorB:"#6e6151",shape:ge.ELLIPSE,minParticleSpeed:.0015*E.TILE_SIZE,maxParticleSpeed:.0025*E.TILE_SIZE,minLifetimeMs:500,maxLifetimeMs:600,minRadius:.035*E.TILE_SIZE,maxRadius:.055*E.TILE_SIZE}}(l)));var y=A({startTile:s.tile,maxDepth:c.damageManhattanDistanceRadius,isAvailable:function(e){return!0},canGoThrough:function(e){return!0}}),h=function(e){var t=u.gameState.getAliveCharacters().find((function(t){return t.tileCoords.equals(e)}));if(t){var n=t.tileCoords.manhattanDistanceTo(s.tile),a=Math.pow(c.tilesAwayDamageReduction,n),r=c.damage*a;t.health-=r}},u=this;try{for(var x=i(y),d=x.next();!d.done;d=x.next()){h(d.value)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(a=x.return)&&a.call(x)}finally{if(n)throw n.error}}}else{var f=this.gameState.getAliveCharacters().find((function(e){return e.tileCoords.equals(s.tile)}));f&&f!==this.gameState.selectedCharacter&&!s.isTargetGridBorder&&(f.health-=t.projectileDetails.damage),this.particleSystems.push(new Ge(function(e){return{startPositionCanvas:e,particleCount:60,colorA:"#a83232",colorB:"#cc7606",shape:ge.LINE,minParticleSpeed:.003*E.TILE_SIZE,maxParticleSpeed:.005*E.TILE_SIZE,minLifetimeMs:100,maxLifetimeMs:200,minRadius:.035*E.TILE_SIZE,maxRadius:.065*E.TILE_SIZE}}(l)))}t.setIsDead();try{for(var g=i(this.projectiles.filter((function(e){return!e.isDead}))),m=g.next();!m.done;m=g.next()){var p=m.value,T=p.getCurrentTarget().ray,v=Ke({ray:T,startingTileCoords:E.getTileFromCanvasCoords(T.startPt),fromTeamIndex:p.fromTeamIndex,numRicochets:p.getNumRicochetsLeft(),characters:this.gameState.getAliveCharacters(),obstacles:this.gameState.obstacles});p.setNewTargets(v)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(o=g.return)&&o.call(g)}finally{if(r)throw r.error}}}},e.prototype.shouldSkipAnimation=function(e){return!!this.isAiTurn()&&this.gameState.settings.matchType===I.AI_VS_AI},e.prototype.render=function(){var e,t,n,r,o,s,l,c,y,h,u,x,d,f,g=this.context;if(g.fillStyle=L,g.clearRect(0,0,a.canvasWidth,a.canvasHeight),g.fillRect(0,0,a.canvasWidth,a.canvasHeight),P&&this.blackWoodTexture.tryDrawing({context:g,sourceX:0,sourceY:0,sourceWidth:E.GAME_WIDTH,sourceHeight:E.GAME_HEIGHT,canvasX:0,canvasY:0,canvasWidth:E.GAME_WIDTH,canvasHeight:E.GAME_HEIGHT}),null!=this.gameState.selectableTiles&&this.gameState.selectableTiles.length){if(!this.isAiTurn())try{for(var m=i(this.gameState.selectableTiles),T=m.next();!T.done;T=m.next()){var v=T.value,S=E.getCanvasFromTileCoords(v);g.fillStyle=U,g.fillRect(S.x,S.y,E.TILE_SIZE,E.TILE_SIZE)}}catch(t){e={error:t}}finally{try{T&&!T.done&&(t=m.return)&&t.call(m)}finally{if(e)throw e.error}}var C=E.getTileFromCanvasCoords(p.getMouseCanvasCoords());if(this.gameState.selectableTiles.find((function(e){return e.equals(C)}))){S=E.getCanvasFromTileCoords(C);g.fillStyle=z,g.fillRect(S.x,S.y,E.TILE_SIZE,E.TILE_SIZE)}}try{for(var A=i(this.gameState.obstacles),I=A.next();!I.done;I=A.next()){I.value.render(g)}}catch(e){n={error:e}}finally{try{I&&!I.done&&(r=A.return)&&r.call(A)}finally{if(n)throw n.error}}try{for(var w=i(this.gameState.flags),b=w.next();!b.done;b=w.next()){b.value.render(this.context)}}catch(e){o={error:e}}finally{try{b&&!b.done&&(s=w.return)&&s.call(w)}finally{if(o)throw o.error}}try{for(var M=i(this.gameState.getAliveCharacters()),R=M.next();!R.done;R=M.next()){var _=R.value;this.shouldRenderCharacter(_)&&_.render(this.context)}}catch(e){l={error:e}}finally{try{R&&!R.done&&(c=M.return)&&c.call(M)}finally{if(l)throw l.error}}try{for(var D=i(this.gameState.spawners),F=D.next();!F.done;F=D.next()){F.value.render(this.context)}}catch(e){y={error:e}}finally{try{F&&!F.done&&(h=D.return)&&h.call(D)}finally{if(y)throw y.error}}if(null!=this.gameState.selectedCharacter&&!this.isAiTurn()){S=E.getCanvasFromTileCoords(this.gameState.selectedCharacter.tileCoords);g.strokeStyle=W,g.lineWidth=2,g.strokeRect(S.x,S.y,E.TILE_SIZE,E.TILE_SIZE)}try{for(var k=i(this.projectiles),O=k.next();!O.done;O=k.next()){var N=O.value;this.shouldRenderObjectAtTile(N.tileCoords)&&N.render()}}catch(e){u={error:e}}finally{try{O&&!O.done&&(x=k.return)&&x.call(k)}finally{if(u)throw u.error}}try{for(var H=i(this.particleSystems),G=H.next();!G.done;G=H.next()){var B=G.value;this.shouldRenderObjectAtTile(B.tileCoords)&&B.render(this.context)}}catch(e){d={error:e}}finally{try{G&&!G.done&&(f=H.return)&&f.call(H)}finally{if(d)throw d.error}}this.renderFogOfWar(this.context),this.hud.render(),this.inputManager.render()},e.prototype.shouldRenderCharacter=function(e){if(!this.gameState.isFogOfWarOn())return!0;if(this.gameState.settings.matchType===I.PLAYER_VS_PLAYER_LOCAL||this.gameState.settings.matchType===I.AI_VS_AI)return this.gameState.isTileVisibleByTeamIndex(e.tileCoords,this.gameState.currentTeamIndex);if(0===e.teamIndex)return!0;var t=E.getTileFromCanvasCoords(e.animationState.currentCenterCanvas);return this.gameState.isTileVisibleByTeamIndex(t,0)},e.prototype.shouldRenderObjectAtTile=function(e){return!this.gameState.isFogOfWarOn()||(this.gameState.settings.matchType===I.PLAYER_VS_PLAYER_LOCAL||this.gameState.settings.matchType===I.AI_VS_AI?this.gameState.isTileVisibleByTeamIndex(e,this.gameState.currentTeamIndex):this.gameState.isTileVisibleByTeamIndex(e,0))},e.prototype.renderFogOfWar=function(e){if(this.gameState.isFogOfWarOn()){var t=[];this.gameState.settings.matchType===I.PLAYER_VS_PLAYER_LOCAL||this.gameState.settings.matchType===I.AI_VS_AI?t=this.gameState.getTilesVisibleByTeamIndex(this.gameState.currentTeamIndex):this.gameState.settings.matchType===I.PLAYER_VS_AI&&(t=this.gameState.getTilesVisibleByTeamIndex(0)),this.gameState.gamePhase!==Ye.CHARACTER_PLACEMENT||this.isAiTurn()||(t=t.concat(this.gameState.selectableTiles)),e.fillStyle=_;for(var n=0;n<E.TILES_WIDE;n++)for(var a=function(a){var r=new y(n,a);if(t.find((function(e){return e.equals(r)})))return"continue";var i=E.getCanvasFromTileCoords(r);e.fillRect(i.x,i.y,E.TILE_SIZE,E.TILE_SIZE)},r=0;r<E.TILES_TALL;r++)a(r)}},e.prototype.destroy=function(){this.inputManager&&this.inputManager.clear()},e.prototype.onAction=function(e){var t,n;if(!this.isPaused){var a=this.gameState.getActiveSquad();switch(e.type){case ue.SHOOT:if(null==this.gameState.selectedCharacter)throw new Error("Selected character is null on FIRE action");var r=this.gameState.selectedCharacter.shoot();try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var l=s.value;this.fireShot(l),this.addOnAnimationDoneCallback(this.onProjectileAnimationOver)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}break;case ue.HEAL:if(null==this.gameState.selectedCharacter)throw new Error("Selected character is null on HEAL action");this.gameState.selectedCharacter.regenHealth(e.healAmount),this.gameState.selectedCharacter.useAbility(de.HEAL);var c=E.getCanvasFromTileCoords(this.gameState.selectedCharacter.tileCoords).add(E.HALF_TILE);this.particleSystems.push(new Ge({startPositionCanvas:c,particleCount:12,colorA:"#1bd133",colorB:"#07ad1d",shape:ge.PLUS,minParticleSpeed:.001*E.TILE_SIZE,maxParticleSpeed:.002*E.TILE_SIZE,minLifetimeMs:600,maxLifetimeMs:800,minRadius:.07*E.TILE_SIZE,maxRadius:.12*E.TILE_SIZE})),this.checkCharacterTurnOver();break;case ue.END_CHARACTER_TURN:if(null==this.gameState.selectedCharacter)throw new Error("Selected character is null on END_CHARACTER_TURN action");this.gameState.selectedCharacter.setTurnOver(),this.onCharacterTurnOver();break;case ue.AIM:if(null==this.gameState.selectedCharacter)throw new Error("No selected character when trying to aim");this.gameState.selectedCharacter.setAim(e.aimAngleClockwiseRadians);break;case ue.SELECT_TILE:if(!this.gameState.selectableTiles.find((function(t){return t.equals(e.tile)})))throw new Error("Invalid tile selection: "+e.tile.toString());if(this.gameState.gamePhase===Ye.COMBAT){if(null==this.gameState.selectedCharacter)throw new Error("Selected character is null on SELECT_TILE action in combat phase");if(this.gameState.selectableTiles=[],this.gameState.selectedCharacterState===Qe.MOVING)this.handleCharacterMovement(e.tile);else if(this.gameState.selectedCharacterState===Qe.THROWING_GRENADE){var y={splashDamage:this.gameState.selectedCharacter.getGrenadeAbility().splashDamage,tile:e.tile};this.gameState.selectedCharacter.useAbility(de.THROW_GRENADE),this.throwGrenade(y)}}else{var h=a.length;this.gameState.characters.push(new $e({startCoords:e.tile,teamIndex:this.gameState.currentTeamIndex,index:h,settings:this.selectedCharacterSettings,gameDelegate:this.gameDelegate}));var u=this.gameSettings.teamIndexToSquadSize.get(this.gameState.currentTeamIndex);a.length+1===u?this.nextTurn():this.gameState.selectableTiles=this.gameState.selectableTiles.filter((function(t){return!t.equals(e.tile)}))}break;case ue.SELECT_CHARACTER:var x=a.find((function(t){return t.index===e.characterIndex}));if(null==x)throw new Error("Can't find character in SELECT_CHARACTER action. cur team index: "+this.gameState.currentTeamIndex+";  charIndex: "+e.characterIndex);if(x.isTurnOver()||!x.isAlive())throw new Error("Selected character is dead or turn is over.");this.gameState.selectedCharacter.cancelAiming(),this.setSelectedCharacter(e.characterIndex);break;case ue.SELECT_CHARACTER_STATE:this.setSelectedCharacterState(e.state);break;case ue.SELECT_CHARACTER_CLASS:this.selectedCharacterSettings=e.class;break;default:!function(e){throw new Error("Action not handled")}()}}},e.prototype.checkGameOver=function(){if(this.gameState.spawners.length>0&&0!==this.gameState.getCharactersForTeamIndex(0).length)return;var e=null,t=-1;0===this.gameState.getEnemyCharacters().length?(t=this.gameState.currentTeamIndex,e=this.gameState.getActiveTeamName()):0===this.gameState.getActiveSquad().length&&(e=this.gameState.getEnemyTeamName(),t=(1+this.gameState.currentTeamIndex)%this.gameSettings.numTeams),null!=e&&this.setGameOver(t,e+" has elimanted all oponents.")},e.prototype.checkCharacterTurnOver=function(){this.gameState.selectedCharacter.isTurnOver()?this.onCharacterTurnOver():this.setSelectedCharacterState(Qe.AWAITING)},e.prototype.onCharacterTurnOver=function(){var e=this.gameState.getActiveSquad().find((function(e){return!e.isTurnOver()&&e.isAlive()}));e?this.setSelectedCharacter(e.index):this.nextTurn()},e.prototype.nextTurn=function(){this.gameState.gamePhase===Ye.CHARACTER_PLACEMENT?this.gameState.currentTeamIndex+1<this.gameSettings.numTeams?(this.gameState.currentTeamIndex+=1,this.initCharacterPlacementTurn()):(this.gameState.gamePhase=Ye.COMBAT,this.advanceToNextCombatTurn()):this.advanceToNextCombatTurn()},e.prototype.isAiTurn=function(){return!this.isGameOver&&this.teamIndexToIsAi[this.gameState.currentTeamIndex]},e.prototype.initCharacterPlacementTurn=function(){this.gameState.selectableTiles=this.getAvailableTilesForCharacterPlacement();var e=this.gameState.getActiveTeamName(),t=this.gameSettings.teamIndexToSquadSize.get(this.gameState.currentTeamIndex);this.hud.setText(e+" team turn",Ne.TITLE,Oe.LONG),this.hud.setText("Place squad members ("+t+" remaining) ",Ne.SUBTITLE,Oe.LONG),this.isAiTurn()?this.inputManager.initDefaultControls():this.inputManager.initForCharacterPlacement()},e.prototype.advanceToNextCombatTurn=function(){var e,t,n,a,r=this.gameState.currentTeamIndex;try{for(var o=i(this.gameState.spawners),s=o.next();!s.done;s=o.next()){var l=s.value;if(l.teamIndex===r){l.advanceTurn();var c=this.gameState.characters.filter((function(e){return e.teamIndex===r})).length;if(l.checkAndHandleRespawn()){var y=new $e({startCoords:l.tileCoords,teamIndex:this.gameState.currentTeamIndex,index:c,settings:this.selectedCharacterSettings,gameDelegate:this.gameDelegate});this.gameState.characters.push(y)}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}this.gameState.currentTeamIndex=(this.gameState.currentTeamIndex+1)%this.gameSettings.numTeams;var h=this.gameState.getActiveSquad();if(0!==h.length){try{for(var u=i(h),x=u.next();!x.done;x=u.next()){(y=x.value).resetTurnState()}}catch(e){n={error:e}}finally{try{x&&!x.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}var d=this.gameState.getActiveTeamName();this.setSelectedCharacter(this.gameState.getFirstCharacterIndex()),this.hud.setText(d+" team turn",Ne.TITLE,Oe.LONG)}else this.advanceToNextCombatTurn()},e.prototype.getCurrentTurnAi=function(){var e=this;return this.ais.find((function(t){return t.teamIndex===e.gameState.currentTeamIndex}))},e.prototype.getGameState=function(){return this.gameState},e.prototype.addOnAnimationDoneCallback=function(e){this.onAnimationDone=e,this.inputManager.initDefaultControls()},e.prototype.handleCharacterMovement=function(e){var t=this,n=this.gameState.selectedCharacter;if(n.tileCoords.manhattanDistanceTo(e)>n.settings.maxMovesPerTurn)throw new Error("Invalid character movement location (too far): start: "+n.tileCoords.toString()+", end: "+e.toString());var a=this.gameState.getPath({from:n.tileCoords,to:e}),r=function(e,t){var n,a,r=[],o=e,s=function(e){return E.getCanvasFromTileCoords(e).add(E.HALF_TILE)},l=s(o);try{for(var c=i(t),y=c.next();!y.done;y=c.next()){var h=y.value,u=s(h),x=u.subtract(l).normalize(),d={ray:new oe(l,x),canvasCoords:u,tile:h,maxDistance:l.distanceTo(u)};o=h,l=u,r.push(d)}}catch(e){n={error:e}}finally{try{y&&!y.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return r}(n.tileCoords,a),o=this.gameState.getEnemyFlag(),s=this.gameState.getActiveTeamFlag(),l=n.tileCoords.equals(o.tileCoords);n.moveTo(e,r),this.addOnAnimationDoneCallback((function(){s.isAtStart()&&o.tileCoords.equals(s.tileCoords)?t.setGameOver(t.gameState.currentTeamIndex,t.gameState.getActiveTeamName()+" team has snagged the flag."):t.checkCharacterTurnOver()})),l?(o.setIsTaken((function(){return n.animationState.currentCenterCanvas.subtract(E.HALF_TILE)})),o.tileCoords=e):o.tileCoords.equals(e)&&this.hud.setText(this.gameState.getActiveTeamName()+" team has taken the flag.",Ne.SUBTITLE,Oe.SHORT),!s.isAtStart()&&s.tileCoords.equals(e)&&(s.returnToStart(),this.hud.setText(this.gameState.getActiveTeamName()+" team has returned their flag.",Ne.SUBTITLE,Oe.SHORT))},e.prototype.setGameOver=function(e,t){this.inputManager.initGameOverControls(),this.togglePause(),this.isGameOver=!0,this.winningTeamIndex=e,this.hud.setText("Game over",Ne.TITLE,Oe.LONG),this.hud.setText(""+t,Ne.SUBTITLE,Oe.LONG)},e.prototype.fireShot=function(e){var t=je(e),n=e.projectileDetails.type===ye.BULLET?e.projectileDetails.numRicochets:0,a=Ke({ray:t,startingTileCoords:e.fromTileCoords,fromTeamIndex:e.fromTeamIndex,numRicochets:n,characters:this.gameState.getAliveCharacters(),obstacles:this.gameState.obstacles});rt.log(et.TARGET_FINDING,"Targets: "+JSON.stringify(a)),this.projectiles.push(new Pe({context:this.context,projectileDetails:e.projectileDetails,targets:a,fromTeamIndex:e.fromTeamIndex}))},e.prototype.throwGrenade=function(e){var t=this.gameState.selectedCharacter.tileCoords,n=E.getCanvasFromTileCoords(t).add(E.HALF_TILE),a=e.tile,r=E.getCanvasFromTileCoords(a).add(E.HALF_TILE),i=r.subtract(n).normalize(),o={canvasCoords:r,ray:new oe(n,i),tile:a,maxDistance:r.distanceTo(n)},s={fromTeamIndex:this.gameState.selectedCharacter.teamIndex,fromCanvasCoords:n,fromTileCoords:t,aimAngleRadiansClockwise:i.getPointRotationRadians(),projectileDetails:e.splashDamage},l=new Pe({context:this.context,projectileDetails:s.projectileDetails,targets:[o],fromTeamIndex:s.fromTeamIndex});this.projectiles.push(l),this.addOnAnimationDoneCallback(this.onProjectileAnimationOver)},e.prototype.getAvailableTilesForCharacterPlacement=function(){var e=this,t=this.gameState.getActiveTeamFlag().tileCoords,n=this.gameSettings.maxSpawnDistanceFromFlag;return A({startTile:t,maxDepth:n,isAvailable:function(n){return!e.isTileOccupied(n)&&!n.equals(t)},canGoThrough:function(t){return!e.gameState.tileHasObstacle(t)}})},e.prototype.getAvailableTilesForCharacterMovement=function(){var e=this;if(null==this.gameState.selectedCharacter)throw new Error("No character selected in getAvailableTilesForCharacterMovement");var t=this.gameState.getActiveTeamFlag(),n=this.gameState.getActiveTeamFlag().tileCoords,a=this.gameState.selectedCharacter.tileCoords,r=this.gameState.selectedCharacter.settings.maxMovesPerTurn,i=function(a){return!e.isTileOccupied(a)&&(!!e.gameState.selectedCharacter.tileCoords.equals(e.gameState.getEnemyFlag().tileCoords)||(!t.isAtStart()||!a.equals(n)))};return A({startTile:a,maxDepth:r,isAvailable:i,canGoThrough:function(t){return i(t)||e.gameState.isSquadMemberAtTile(t)}})},e.prototype.getAvailableTilesForThrowingGrenade=function(){var e=this;if(null==this.gameState.selectedCharacter)throw new Error("No character selected in getAvailableTilesForThrowingGrenade");this.gameState.getActiveTeamFlag();var t=this.gameState.selectedCharacter.tileCoords,n=this.gameState.selectedCharacter.getGrenadeAbility().maxManhattanDistance;return A({startTile:t,maxDepth:n,isAvailable:function(n){return!e.gameState.tileHasObstacle(n)&&!n.equals(t)&&!e.gameState.isSquadMemberAtTile(n)},canGoThrough:function(e){return E.inbounds(e)}})},e.prototype.setSelectedCharacter=function(e){var t=this.gameState.getActiveSquad().find((function(t){return t.index===e}));t.isTurnOver()?this.hud.setText("Unit "+(e+1)+"'s turn is over.",Ne.TOAST,Oe.SHORT):(this.gameState.selectedCharacter=t,this.setSelectedCharacterState(Qe.AWAITING))},e.prototype.setSelectedCharacterState=function(e){if(null==this.gameState.selectedCharacter)throw new Error("There needs to be a selected character before calling setSelectedCharacterState");switch(this.gameState.selectedCharacterState=e,e){case Qe.AWAITING:this.gameState.selectableTiles=[],this.gameState.selectedCharacter.cancelAiming();break;case Qe.MOVING:this.gameState.selectableTiles=this.getAvailableTilesForCharacterMovement();break;case Qe.AIMING:this.gameState.selectedCharacter.startAiming();break;case Qe.THROWING_GRENADE:this.gameState.selectableTiles=this.getAvailableTilesForThrowingGrenade();break;default:throw new Error("Unknown selected character state")}this.isAiTurn()?this.inputManager.initDefaultControls():this.inputManager.initForSelectedCharacterState()},e.prototype.isTileOccupied=function(e){var t=this.gameState.obstacles.find((function(t){return t.tileCoords.equals(e)})),n=this.gameState.getAliveCharacters().find((function(t){return t.isAlive()&&t.tileCoords.equals(e)})),a=this.gameState.spawners.find((function(t){return t.tileCoords.equals(e)}));return null!=t||null!=n||null!=a},e.prototype.loadLevel=function(){var e=ae[this.levelIndex],t=new Me({tileCoords:u(e.data.blueFlag),teamIndex:0}),n=new Me({tileCoords:u(e.data.redFlag),teamIndex:1});if(this.gameState.flags=[t,n],this.gameState.obstacles=e.data.obstacles.map((function(e){return new qe(u(e))})),this.gameState.spawners=[],this.gameState.settings.hasSpawners){var a=new Map([[w.WEAK,8],[w.MEDIUM,6],[w.STRONG,5]]),r={tileCoords:u(e.aiSpawner),teamIndex:1,turnsBetweenSpawns:a.get(this.gameState.settings.aiDifficulty)};this.gameState.spawners.push(new ut(r))}},e.prototype.togglePause=function(){this.isPaused=!this.isPaused,this.isPaused?this.hud.setText("PAUSED",Ne.TITLE,Oe.SHORT):(this.hud.clearText(Ne.TITLE),this.hud.clearText(Ne.TOAST))},e}();!function(e){e[e.BLUE_FLAG=0]="BLUE_FLAG",e[e.RED_FLAG=1]="RED_FLAG",e[e.OBSTACLE=2]="OBSTACLE",e[e.ERASE=3]="ERASE"}(Ot||(Ot={}));var Gt=function(){function e(e,t,n){var a=this;this.saveLevel=function(){if(null==a.blueFlag||null==a.redFlag)throw new Error("Need to add both flags!");var e={redFlag:a.redFlag.tileCoords,blueFlag:a.blueFlag.tileCoords,obstacles:a.obstacles.map((function(e){return e.tileCoords}))};console.log(JSON.stringify(e))},this.resetGame=function(){a.destroy(),a.placementMode=Ot.OBSTACLE,a.obstacles=[],a.redFlag=void 0,a.blueFlag=void 0,a.controlMap=new d,a.controlMap.add({key:x.Q,name:"Quit",func:a.onExitGameCallback,eventType:l.KeyPress}),a.controlMap.add({key:x.R,name:"Reset",func:a.resetGame,eventType:l.KeyPress}),a.controlMap.add({key:x.S,name:"Save",func:a.saveLevel,eventType:l.KeyPress}),a.controlMap.add({key:x.O,name:"Place Obstacles",func:function(){a.setPlacementMode(Ot.OBSTACLE)},eventType:l.KeyPress}),a.controlMap.add({key:x.B,name:"Place Blue Flag",func:function(){a.setPlacementMode(Ot.BLUE_FLAG)},eventType:l.KeyPress}),a.controlMap.add({key:x.V,name:"Place Red Flag",func:function(){a.setPlacementMode(Ot.RED_FLAG)},eventType:l.KeyPress}),a.controlMap.add({key:x.E,name:"Erase",func:function(){a.setPlacementMode(Ot.ERASE)},eventType:l.KeyPress})},this.canvas=e,this.context=t,this.onExitGameCallback=n,this.resetGame()}return e.prototype.update=function(e){if(this.controlMap.check(),p.hasClick()){var t=p.handleClick(),n=E.getTileFromCanvasCoords(t);if(this.isTileOccupied(n))this.placementMode===Ot.ERASE&&this.removeObjectInTile(n);else switch(this.placementMode){case Ot.BLUE_FLAG:this.blueFlag=new Me({tileCoords:n,teamIndex:0});break;case Ot.RED_FLAG:this.redFlag=new Me({tileCoords:n,teamIndex:1});break;case Ot.OBSTACLE:var a=new qe(n);this.obstacles.push(a)}}},e.prototype.isTileOccupied=function(e){return!(null==this.redFlag||!this.redFlag.tileCoords.equals(e))||(!(null==this.blueFlag||!this.blueFlag.tileCoords.equals(e))||null!=this.obstacles.find((function(t){return t.tileCoords.equals(e)})))},e.prototype.removeObjectInTile=function(e){null!=this.redFlag&&this.redFlag.tileCoords.equals(e)&&(this.redFlag=void 0),null!=this.blueFlag&&this.blueFlag.tileCoords.equals(e)&&(this.blueFlag=void 0),this.obstacles=this.obstacles.filter((function(t){return!t.tileCoords.equals(e)}))},e.prototype.render=function(){var e,t,n=this.context,a=E.GAME_WIDTH,r=E.GAME_HEIGHT;n.fillStyle=L,n.clearRect(0,0,a,r),n.fillRect(0,0,a,r);for(var o=0;o<E.TILES_WIDE;o++){var s=y=o*E.TILE_SIZE,l=0,c=r;n.beginPath(),n.strokeStyle=b,n.moveTo(y,l),n.lineTo(s,c),n.stroke()}for(o=0;o<E.TILES_TALL;o++){var y=0;s=a,c=l=o*E.TILE_SIZE;n.beginPath(),n.strokeStyle=b,n.moveTo(y,l),n.lineTo(s,c),n.stroke()}var h=E.getTileFromCanvasCoords(p.getMouseCanvasCoords()),u=E.getCanvasFromTileCoords(h);if(E.inbounds(h)&&this.placementMode!==Ot.ERASE&&!this.isTileOccupied(h)){var x=E.getCanvasFromTileCoords(h),d=D;this.placementMode===Ot.RED_FLAG?d=k:this.placementMode===Ot.BLUE_FLAG&&(d=O);var f=Fe(d);f.a=.7,n.fillStyle=ke(f),n.fillRect(x.x,x.y,E.TILE_SIZE,E.TILE_SIZE)}try{for(var g=i(this.obstacles),m=g.next();!m.done;m=g.next()){m.value.render(n)}}catch(t){e={error:t}}finally{try{m&&!m.done&&(t=g.return)&&t.call(g)}finally{if(e)throw e.error}}null!=this.redFlag&&this.redFlag.render(this.context),null!=this.blueFlag&&this.blueFlag.render(this.context),this.placementMode===Ot.ERASE&&this.isTileOccupied(h)&&(n.fillStyle="#000000",n.fillRect(u.x,u.y,E.TILE_SIZE,E.TILE_SIZE)),this.renderControls()},e.prototype.renderControls=function(){var e,t,n=this.context;n.fillStyle=R;n.font="18px fantasy";var r=new y(a.canvasWidth/64,a.canvasHeight/32);try{for(var o=i(this.controlMap.assignedControls.keys()),s=o.next();!s.done;s=o.next()){var l=s.value,c=p.getAssignedControlMap().get(l);n.fillText(p.getStringForKey(l)+" - "+c,r.x,r.y),r=r.add(new y(0,22))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.destroy=function(){this.controlMap&&this.controlMap.clear()},e.prototype.setPlacementMode=function(e){this.placementMode=e},e}(),Bt=[{levelIndex:0,levelName:"Starting grounds",teamIndexToSquadSize:new Map([[0,4],[1,4]]),isUnlocked:!0,aiDifficulty:w.WEAK},{levelIndex:1,levelName:"Getting tougher",teamIndexToSquadSize:new Map([[0,3],[1,5]]),isUnlocked:!1,aiDifficulty:w.WEAK},{levelIndex:7,levelName:"Protect it",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.WEAK},{levelIndex:3,levelName:"Snag it",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.WEAK},{levelIndex:8,levelName:"Familiar",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.MEDIUM},{levelIndex:9,levelName:"Snarls",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.MEDIUM},{levelIndex:6,levelName:"To snag...",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.MEDIUM},{levelIndex:2,levelName:"Or be snagged...",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.MEDIUM},{levelIndex:4,levelName:"Snag and tag",teamIndexToSquadSize:new Map([[0,6],[1,16]]),isUnlocked:!1,aiDifficulty:w.STRONG},{levelIndex:5,levelName:"Flag of snag",teamIndexToSquadSize:new Map([[0,8],[1,24]]),isUnlocked:!1,aiDifficulty:w.STRONG},{levelIndex:10,levelName:"Frag and flag",teamIndexToSquadSize:new Map([[0,8],[1,24]]),isUnlocked:!1,aiDifficulty:w.STRONG},{levelIndex:11,levelName:"Final snag",teamIndexToSquadSize:new Map([[0,6],[1,16]]),isUnlocked:!1,aiDifficulty:w.STRONG}];function Wt(){var e=window.localStorage.getItem("SnagTheFlag_Campgain_LastUnlockedCampaignLevelIndex");return null!=e?Number.parseInt(e):-1}!function(){for(var e=Wt(),t=0;t<Bt.length;t++){var n=Bt[t];e>=t&&(n.isUnlocked=!0)}}();var Ut,zt,Zt=function(){function e(e,t,n){this.canvas=e,this.context=t,this.onSelectLevel=n.onSelectLevel,this.onBack=n.onBack,this.uiManager=new xt(t);this.initSettingsElements(.04),this.initLevelElements(.54),this.initButtons(.1)}return e.prototype.update=function(e){if(this.uiManager.onMouseMove(p.getMouseCanvasCoords()),p.hasClick()){var t=p.handleClick();this.uiManager.onClick(t)}},e.prototype.render=function(){this.context.fillStyle=te,this.context.clearRect(0,0,a.canvasWidth,a.canvasHeight),this.context.fillRect(0,0,a.canvasWidth,a.canvasHeight),this.renderTitleText(),this.uiManager.render()},e.prototype.destroy=function(){},e.prototype.initButtons=function(e){var t=this,n=new y(.18,.08),a=new ft({dimensions:{size:n,topLeft:new y(e,.9),text:"Back"},style:{fontSize:22,color:"#d9c8a3",hoverColor:"#e6dbc3",textColor:ne},onClick:this.onBack});this.uiManager.addElement(a);var r=e+n.x+.04,i=new ft({dimensions:{size:n,text:"Start",topLeft:new y(r,.9)},style:{color:"#66d15a",hoverColor:"#7aed6d",fontSize:28,textColor:ne},onClick:function(){var e=t.selectedTeamSizeMap.get(1)>16?16:re,n={matchType:t.selectedMatchType,teamIndexToSquadSize:t.selectedTeamSizeMap,maxSpawnDistanceFromFlag:e,numTeams:ie,hasFogOfWar:t.isFogOfWarOn,aiDifficulty:t.selectedAiDifficulty,hasSpawners:t.hasSpawners};t.onSelectLevel(t.selectedLevelIndex,n)}});this.uiManager.addElement(i)},e.prototype.initSettingsElements=function(e){var t=this,n=new y(.09,.06),a=new y(.18,.08),r=.18+.02+a.y,i={color:"#dddddd",fontSize:22,textColor:"#000000"},o={color:te,fontSize:20,textColor:"#000000"},s={fontSize:20,color:"#f7c25e",hoverColor:"#deaf57",selectedColor:"#db9d2a",selectedBorderColor:"#000000",textColor:ne},l=new dt({dimensions:{size:a,text:"Settings",topLeft:new y(.25-a.x/2,.18)},style:i});this.uiManager.addElement(l);var c=function(t){for(var a=new y(.14,.06),r=e,i=new dt({dimensions:{size:a,text:t.headerText,topLeft:new y(r,t.topY)},style:o}),l=r+a.x+.02,c=[],h=0;h<t.buttonTexts.length;h++){var u=h%3,x=Math.floor(h/3),d=l+u*(.04+n.y),f=t.topY+x*(.02+n.y);c.push({topLeft:new y(d,f),size:n,text:t.buttonTexts[h]})}return t.onButtonChangeCallback(t.initialButtonIndex),[i,new gt({buttons:c,buttonStyle:s,initialSelectionIndex:t.initialButtonIndex,onChangeCallback:t.onButtonChangeCallback})]},h=[new Map([[0,2],[1,2]]),new Map([[0,4],[1,4]]),new Map([[0,8],[1,8]]),new Map([[0,12],[1,12]]),new Map([[0,8],[1,24]])],u=h.map((function(e){return e.get(0)+"x"+e.get(1)})),x=r,d=x+2*n.y+.02+.04,f=d+n.y+.04,g=f+n.y+.04,m=g+n.y+.04,p=c({topY:x,rows:2,headerText:"Team size",buttonTexts:u,initialButtonIndex:0,onButtonChangeCallback:function(e){t.selectedTeamSizeMap=h[e]}});this.uiManager.addElement(p[0]),this.uiManager.addElement(p[1]);var T=[w.WEAK,w.MEDIUM,w.STRONG],v=c({topY:f,rows:1,headerText:"Difficulty",buttonTexts:["Easy","Medium","Hard"],initialButtonIndex:0,onButtonChangeCallback:function(e){t.selectedAiDifficulty=T[e]}});this.uiManager.addElement(v[0]),this.uiManager.addElement(v[1]);var S=[I.PLAYER_VS_PLAYER_LOCAL,I.PLAYER_VS_AI,I.AI_VS_AI],C=c({topY:d,rows:1,headerText:"Match type",buttonTexts:["PvP","PvAI","AIvAI"],initialButtonIndex:1,onButtonChangeCallback:function(e){var n=t.selectedMatchType;t.selectedMatchType=S[e],t.selectedMatchType===I.PLAYER_VS_PLAYER_LOCAL&&n!==I.PLAYER_VS_PLAYER_LOCAL?(t.uiManager.removeElement(v[0]),t.uiManager.removeElement(v[1])):t.selectedMatchType!==I.PLAYER_VS_PLAYER_LOCAL&&n===I.PLAYER_VS_PLAYER_LOCAL&&(t.uiManager.addElement(v[0]),t.uiManager.addElement(v[1]))}});this.uiManager.addElement(C[0]),this.uiManager.addElement(C[1]);var E=[!0,!1],A=c({topY:g,rows:1,headerText:"Fog of war",buttonTexts:["On","Off"],initialButtonIndex:1,onButtonChangeCallback:function(e){t.isFogOfWarOn=E[e]}});this.uiManager.addElement(A[0]),this.uiManager.addElement(A[1]);var L=[!0,!1],b=c({topY:m,rows:1,headerText:"Spawners",buttonTexts:["On","Off"],initialButtonIndex:1,onButtonChangeCallback:function(e){t.hasSpawners=L[e]}});this.uiManager.addElement(b[0]),this.uiManager.addElement(b[1])},e.prototype.initLevelElements=function(e){var t=this,n=new y(.18,.08),a=.18+.02+n.y,r={color:"#dddddd",fontSize:22,textColor:"#000000"},i={fontSize:22,color:"#f7c25e",hoverColor:"#deaf57",selectedColor:"#db9d2a",selectedBorderColor:"#000000",textColor:ne},o=e,s=o+n.x/2+.02,l=new dt({dimensions:{size:n,text:"Level",topLeft:new y(s,.18)},style:r});this.uiManager.addElement(l);for(var c=[],h=0;h<ae.length;h++){var u=h%6,x=o;1===Math.floor(h/6)&&(x=x+n.x+.04);var d=a+.02*u+u*n.y,f=ae[h];c.push({topLeft:new y(x,d),size:n,text:f.name})}var g=function(e){t.selectedLevelIndex=e};g(0),this.uiManager.addElement(new gt({buttons:c,buttonStyle:i,initialSelectionIndex:0,onChangeCallback:g}))},e.prototype.renderTitleText=function(){this.context.fillStyle=ne;this.context.font="72px fantasy";var e=this.context.measureText("Free Play").width,t=new y(a.canvasWidth/2,a.canvasHeight/6);this.context.fillText("Free Play",t.x-e/2,t.y-36)},e}(),qt=function(){function e(e,t,n){this.canvas=e,this.context=t,this.onSelectLevel=n.onSelectLevel,this.onBack=n.onBack,this.uiManager=new xt(t),this.initLevelMenu()}return e.prototype.update=function(e){if(this.uiManager.onMouseMove(p.getMouseCanvasCoords()),p.hasClick()){var t=p.handleClick();this.uiManager.onClick(t)}},e.prototype.render=function(){this.context.fillStyle=te,this.context.clearRect(0,0,a.canvasWidth,a.canvasHeight),this.context.fillRect(0,0,a.canvasWidth,a.canvasHeight),this.renderTitleText(),this.uiManager.render()},e.prototype.destroy=function(){},e.prototype.initLevelMenu=function(){for(var e=this,t=new y(.24,.08),n=.2+.04+t.y,a={fontSize:24,color:"#f7c25e",hoverColor:"#fcd281",selectedColor:"#db9d2a",selectedBorderColor:"#000000",textColor:ne},r={fontSize:24,color:"#bd7e00",textColor:ne},i=.5-t.x/2,o=i-t.x-.1,s=i+t.x+.1,l=Bt.length/3,c=function(c){var u=Math.floor(c/l),x=c%l,d=n+.04*x+x*t.y,f=Bt[c],g=o;1===u?g=i:2===u&&(g=s);var m={topLeft:new y(g,d),size:t,text:f.isUnlocked?f.levelName:"Locked"};f.isUnlocked?h.uiManager.addElement(new ft({dimensions:m,style:a,onClick:function(){var t={matchType:I.PLAYER_VS_AI,teamIndexToSquadSize:f.teamIndexToSquadSize,numTeams:ie,maxSpawnDistanceFromFlag:re,hasFogOfWar:!0,hasSpawners:!0,aiDifficulty:f.aiDifficulty};e.onSelectLevel(c,f.levelIndex,t)}})):h.uiManager.addElement(new dt({dimensions:m,style:r}))},h=this,u=0;u<Bt.length;u++)c(u);var x=new ft({dimensions:{size:t,topLeft:new y(.08,.86),text:"Back"},style:{fontSize:24,color:"#d9c8a3",hoverColor:"#e6dbc3",textColor:ne},onClick:this.onBack});this.uiManager.addElement(x)},e.prototype.renderTitleText=function(){this.context.fillStyle=ne;this.context.font="72px fantasy";var e="Single Player Campaign",t=this.context.measureText(e).width,n=new y(a.canvasWidth/2,a.canvasHeight/6);this.context.fillText(e,n.x-t/2,n.y-36)},e}(),jt=function(){function e(e,t,n){this.canvas=e,this.context=t,this.onFreePlay=n.onFreePlay,this.onCampaign=n.onCampaign,this.onCreateLevel=n.onCreateLevel,this.uiManager=new xt(t),this.initMenu()}return e.prototype.update=function(e){if(this.uiManager.onMouseMove(p.getMouseCanvasCoords()),p.hasClick()){var t=p.handleClick();this.uiManager.onClick(t)}},e.prototype.render=function(){this.context.fillStyle=te,this.context.clearRect(0,0,a.canvasWidth,a.canvasHeight),this.context.fillRect(0,0,a.canvasWidth,a.canvasHeight),this.renderTitleText(),this.uiManager.render()},e.prototype.destroy=function(){},e.prototype.initMenu=function(){for(var e=new y(.26,.1),t=.5-e.x/2,n=[{text:"Campaign mode",callback:this.onCampaign},{text:"Free play",callback:this.onFreePlay},{text:"Create Level",callback:this.onCreateLevel}],a=0;a<n.length;a++){var r=.3+.08*a+a*e.y,i=n[a],o=new ft({dimensions:{topLeft:new y(t,r),size:e,text:i.text},style:{fontSize:24,color:"#f7c25e",hoverColor:"#fcd281",textColor:ne},onClick:i.callback});this.uiManager.addElement(o)}},e.prototype.renderTitleText=function(){this.context.fillStyle=ne;this.context.font="72px fantasy";var e="Snag the Flag",t=this.context.measureText(e).width,n=new y(a.canvasWidth/2,a.canvasHeight/4);this.context.fillText(e,n.x-t/2,n.y-36)},e}(),Kt=n(0);(zt=Ut||(Ut={}))[zt.START_MENU=0]="START_MENU",zt[zt.FREE_PLAY_MENU=1]="FREE_PLAY_MENU",zt[zt.CAMPAIGN_MENU=2]="CAMPAIGN_MENU",zt[zt.GAME=3]="GAME",zt[zt.LEVEL_CREATOR=4]="LEVEL_CREATOR";var Vt=function(){function e(){var e=this;this.lastRenderTime=0,this.gameState=Ut.START_MENU,this.onSelectFreePlayLevel=function(t,n){e.initGame(t,n,(function(t){e.tearDownCurrentGameState(),e.initFreePlayMenu()}))},this.onSelectCampaignLevel=function(t,n,a){e.initGame(n,a,(function(n){var a,r;0===n&&(a=t+1,r=Wt(),a<Bt.length&&a>r&&(Bt[a].isUnlocked=!0,window.localStorage.setItem("SnagTheFlag_Campgain_LastUnlockedCampaignLevelIndex",""+a))),e.tearDownCurrentGameState(),e.initCampaignMenu()}))},this.onBack=function(){e.tearDownCurrentGameState(),e.initStartMenu()},this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),document.body.classList.add(Kt.body),this.canvas.setAttribute("height",a.canvasHeight+"px"),this.canvas.setAttribute("width",a.canvasWidth+"px"),this.context=this.canvas.getContext("2d"),p.initMouseControls(this.canvas),this.initStartMenu(),window.requestAnimationFrame((function(t){e.lastRenderTime=t,e.gameLoop(t)}))}return e.prototype.gameLoop=function(e){var t=this,n=e-this.lastRenderTime;n>a.msBetweenRenders&&(this.lastRenderTime=e,this.gameStateManager.update(n),this.gameStateManager.render()),window.requestAnimationFrame((function(e){t.gameLoop(e)}))},e.prototype.initStartMenu=function(){var e=this;this.gameState=Ut.START_MENU,this.gameStateManager=new jt(this.canvas,this.context,{onFreePlay:function(){e.tearDownCurrentGameState(),e.initFreePlayMenu()},onCampaign:function(){e.tearDownCurrentGameState(),e.initCampaignMenu()},onCreateLevel:function(){e.tearDownCurrentGameState(),e.initLevelCreator()}})},e.prototype.initGame=function(e,t,n){this.gameState=Ut.GAME,this.gameStateManager=new Ht(this.canvas,this.context,{gameSettings:t,levelIndex:e,onExitGameCallback:n})},e.prototype.initFreePlayMenu=function(){this.gameState=Ut.FREE_PLAY_MENU,this.gameStateManager=new Zt(this.canvas,this.context,{onSelectLevel:this.onSelectFreePlayLevel,onBack:this.onBack})},e.prototype.initCampaignMenu=function(){this.gameState=Ut.CAMPAIGN_MENU,this.gameStateManager=new qt(this.canvas,this.context,{onSelectLevel:this.onSelectCampaignLevel,onBack:this.onBack})},e.prototype.initLevelCreator=function(){var e=this;this.gameState=Ut.LEVEL_CREATOR,this.gameStateManager=new Gt(this.canvas,this.context,(function(){e.tearDownCurrentGameState(),e.initStartMenu()}))},e.prototype.tearDownCurrentGameState=function(){this.gameStateManager.destroy()},e}(),Yt=!1;document.onreadystatechange=function(){"complete"!==document.readyState||Yt||(new Vt,Yt=!0)}}]);
//# sourceMappingURL=app.bundle.js.map